
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="zh-cn" xml:lang="zh-cn">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=gb2312">
   
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
<meta name="copyright" content="(C) 版权 2005">
<meta name="DC.rights.owner" content="(C) 版权 2005">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="如何创建新的应用模板">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="it_60_51_600011_ict">
<meta name="DC.Language" content="zh-cn">
<link rel="stylesheet" type="text/css" href="../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../public_sys-resources/ExpandCollapse.js"></script>
<title>如何创建新的应用模板</title>
</head>
<body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px"><a name="it_60_51_600011_ict"></a><a name="it_60_51_600011_ict"></a>


<h1 class="topictitle1">如何创建新的应用模板</h1>


<div>
<div class="section"><h4 class="sectiontitle">操作场景</h4>


<div class="p"><p><span>应用模板是将虚拟机、软件包、脚本、网络等逻辑组件，按照特定的关系组合而成的业务模型。</span><span>实现批量创建虚拟机，一键式部署应用实例的功能。</span></p>
<p>该任务指导管理员在<span>ServiceCenter</span>中，使用设计面板创建一个全新的应用模板。</p>
</div>

</div>

<div class="section"><h4 class="sectiontitle">前提条件</h4>


<div class="p"><div class="p"><ul><li>已登录<span>ServiceCenter</span>，并进入<span class="menucascade">“<span class="uicontrol">应用</span> &gt; <span class="uicontrol">应用模板</span>”</span>界面。</li><li>已完成应用服务的模型规划。</li></ul>
</div>
</div>

</div>

<div class="section"><h4 class="sectiontitle">操作步骤</h4>

<ol><li><span>在<span class="wintitle">“应用模板”</span>界面，单击<span class="uicontrol">“创建”</span>。</span>
<p>进入<span class="wintitle">“创建应用模板”</span>界面。</p>
</li><li><span>配置模板信息。</span>
<p>待配置的信息如下：<ul><li>名称</li><li>图标</li><li>描述</li></ul>
</p>
</li><li><span>配置模板内容。</span>
<p>模板内容按照OpenStack标准编写。相关信息请参考OpenStack官方网站<a href="http://docs.openstack.org/developer/heat/" target="_blank">http://docs.openstack.org/developer/heat/</a>。<div class="note"><img src="../theme/default/images/icon-note.gif"><span class="notetitle"> 说明： </span><div class="notebody"><p>应用模板支持使用业界的软件包管理器实现软件自动部署功能，如Yum、Zypper、Ubuntu源等。若在应用模板中包含关于软件自动部署功能的代码，在使用该应用模板创建应用实例之前，需先部署对应管理器的安装源服务器，且安装源服务器与应用实例中的虚拟机网络互通。</p>
</div></div>
</p>
</li><li><span>单击<span class="uicontrol">“校验”</span>，确认模板正确后，单击<span class="uicontrol">“保存”</span>。</span></li><li><span>单击<span class="uicontrol">“关闭”</span>，在应用模板列表中，单击<span class="uicontrol">“发布”</span>。</span></li></ol>

</div>

<div class="section"><h4 class="sectiontitle">操作结果</h4>


<div class="p"><p>在应用模板列表中，新增的应用模板状态为<span class="parmvalue">“已发布”</span>，表示该应用模板可用于创建应用实例。</p>
</div>

</div>

<div class="section"><h4 class="sectiontitle">应用模板样例（一）</h4>


<div class="p"><p>该应用模板包含一个虚拟机，其中定义了虚拟机使用的镜像、规格和网络。</p>
<div class="p">代码如下：<div class="note" id="it_60_51_600011_ict__d154e142"><a name="it_60_51_600011_ict__d154e142"></a><a name="d154e142"></a><img src="../theme/default/images/icon-note.gif"><span class="notetitle"> 说明： </span><div class="notebody"><p>在<span>ServiceCenter</span>中填写模板内容时，请勿将注释信息，即“#”和其后的内容填写进去。否则将导致模板不可用。</p>
</div></div>
<pre>{
    "Description":"Simple app template, with one VM to be created.",
    "Parameters":{                                                                                     #应用模板参数
        "ServerAZ":{                                                                                   #创建应用实例选择的可用分区
            "Description":"Availability Zone",                                                         #描述信息
            "Type":"String",                                                                           #变量类型
            "ConstraintDescription":"must be a valid availability zone"                                #限制规则
        },
        "ServerImageId":{                                                                              #创建应用实例虚拟机使用的镜像
            "Description":"EC2 Image Id",                                                              #描述信息
            "Type":"String",                                                                           #变量类型
            "ConstraintDescription":"must be a valid VM template id or image id"                       #限制规则
        },
        "ServerInstanceType":{                                                                         #创建应用实例虚拟机的规格
            "Description":"EC2 Instance Type",                                                         #描述信息
            "Type":"String",                                                                           #变量类型
            "ConstraintDescription":"must be an existed instance type"                                 #限制规则
        },
        "Net0":{                                                                                       #创建应用实例选择的网络
            "Description":"Subnet",                                                                    #描述信息
            "Type":"String",                                                                           #变量类型
            "ConstraintDescription":"must be an existed subnet id"                                     #限制规则
        }
    },
    "Resources":{
        "ServerNic0":{                                                                                 #应用实例的网络接口
            "Type":"AWS::EC2::NetworkInterface",                                                       #应用实例的网络接口类型，建议使用AWS类型的网络接口
            "Properties":{
                "SubnetId":{                                                                           #子网ID
                    "Ref":"Net0"
                },
                "Description":"Interface for control traffic such as SSH"
            }
        },
        "Server":{                                                                                     #应用实例的虚拟机实例
            "Type":"AWS::EC2::Instance",                                                               #应用实例的虚拟机实例，建议使用AWS类型的虚拟机实例
            "Properties":{
                "AvailabilityZone":{                                                                   #可用分区
                    "Ref":"ServerAZ"
                },
                "ImageId":{                                                                            #镜像ID
                    "Ref":"ServerImageId"
                },
                "InstanceType":{                                                                       #虚拟机规格
                    "Ref":"ServerInstanceType"
                },
                "NetworkInterfaces":[                                                                  #网络接口
                    {
                        "DeviceIndex":"0",
                        "NetworkInterfaceId":{
                            "Ref":"ServerNic0"
                        }
                    }
                ]
            }
        }
    }
}</pre>
</div>
</div>

</div>

<div class="section"><h4 class="sectiontitle">应用模板样例（二）</h4>


<div class="p"><p>该应用模板包含一个虚拟机，其中定义了虚拟机使用的镜像、规格和网络，并且为虚拟机定义了伸缩策略。</p>
<div class="p">代码如下：<div class="note"><img src="../theme/default/images/icon-note.gif"><span class="notetitle"> 说明： </span><div class="notebody"><p>在<span>ServiceCenter</span>中填写模板内容时，请勿将注释信息，即“#”和其后的内容填写进去。否则将导致模板不可用。</p>
</div></div>
<pre>{
    "AWSTemplateFormatVersion":"2010-09-09",
    "Description":"AWS CloudFormation Sample Template",
    "Parameters":{                                                                                 #应用模板参数
        "ServerAZ":{                                                                               #创建应用实例选择的可用分区
            "Description":"Availability Zone",                                                     #描述信息
            "Type":"String",                                                                       #变量类型
            "ConstraintDescription":"must be a valid availability zone"                            #限制规则
        },
        "ServerImageId":{                                                                          #创建应用实例虚拟机使用的镜像
            "Description":"EC2 Image Id",                                                          #描述信息
            "Type":"String",                                                                       #变量类型
            "ConstraintDescription":"must be a valid VM template id or image id"                   #限制规则
        },
        "InstanceType":{                                                                           #创建应用实例虚拟机的规格
            "Description":"WebServer EC2 instance type",                                           #描述信息
            "Type":"String",                                                                       #变量类型
            "Default":"m1.small",                                                                  #默认的虚拟机规格
            "AllowedValues":[                                                                      #允许的备选值
                "m1.tiny",
                "m1.small",
                "m1.medium",
                "m1.large",
                "m1.xlarge"
            ],
            "ConstraintDescription":"must be a valid EC2 instance type."                           #限制规则
        },
        "Net0":{                                                                                   #创建应用实例选择的网络
            "Description":"Subnet",                                                                #描述信息
            "Type":"String",                                                                       #变量类型
            "ConstraintDescription":"must be an existed subnet id"                                 #限制规则
        },
        "isDesiredCapacity":{                                                                      #创建应用实例伸缩组中预期的虚拟机个数，在最大虚拟机个数和最小虚拟机个数之间
            "Description":"Desire Capacity",                                                       #描述信息
            "Type":"Number",                                                                       #变量类型
            "ConstraintDescription":"must be an int value between minsize and maxsize"             #限制规则
        },
        "MinSize":{                                                                                #创建应用实例伸缩组中虚拟机个数的最小值，需小于最大值
            "Description":"Min Instance Number",                                                   #描述信息
            "Type":"String",                                                                       #变量类型
            "ConstraintDescription":"must be an int value smaller than maxsize"                    #限制规则
        },
        "MaxSize":{                                                                                #创建应用实例伸缩组中虚拟机个数的最大值，需大于最小值
            "Description":"Max Instance Number",                                                   #描述信息
            "Type":"String",                                                                       #变量类型
            "ConstraintDescription":"must be an int value bigger than minsize"                     #限制规则
        },
        "ScalingUpAdj":{                                                                           #应用实例伸缩组扩容时的步长
            "Description":"Scaling Down Adjustment",                                               #描述信息
            "Type":"String",                                                                       #变量类型
            "ConstraintDescription":"must be an int value"                                         #限制规则
        },
        "ScalingDownAdj":{                                                                         #应用实例伸缩组减容时的步长
            "Description":"Scaling Down Adjustment",                                               #描述信息
            "Type":"String",                                                                       #变量类型
            "ConstraintDescription":"must be an int value"                                         #限制规则
        },
        "ScalingUpThre":{                                                                          #应用实例伸缩组扩容时的CPU利用率门限，需大于伸缩组减容时的CPU利用率门限
            "Description":"Scaling Up Threshold",                                                  #描述信息
            "Type":"String",                                                                       #变量类型
            "ConstraintDescription":"must be an int value between 1 ~ 100"                         #限制规则
        },
        "ScalingDownThre":{                                                                        #应用实例伸缩组减容时的CPU利用率门限，需小于伸缩组扩容时的CPU利用率门限
            "Description":"Scaling Down Threshold",                                                #描述信息
            "Type":"String",                                                                       #变量类型
            "ConstraintDescription":"must be an int value between 1 ~ 100"                         #限制规则
        }
    },
    "Resources":{
        "WebServerGroup":{
            "Type":"AWS::AutoScaling::AutoScalingGroup",                                           #应用实例伸缩组类型，建议使用AWS类型的伸缩组
            "Properties":{
                "AvailabilityZones":[                                                              #可用分区
                    {
                        "Ref":"ServerAZ"
                    }
                ],
                "LaunchConfigurationName":{                                                        #应用实例中虚拟机的配置信息名称
                    "Ref":"LaunchConfig"
                },
                "MinSize":{                                                                        #应用实例中最小虚拟机个数
                    "Ref":"MinSize"
                },
                "DesiredCapacity":{                                                                #应用实例中预期虚拟机个数
                    "Ref":"isDesiredCapacity"
                },
                "MaxSize":{                                                                        #应用实例中最大虚拟机个数
                    "Ref":"MaxSize"
                },
                "VPCZoneIdentifier":[                                                              #应用实例所在网络
                    {
                        "Ref":"Net0"
                    }
                ]
            }
        },
        "WebServerScaleUpPolicy":{                                                                 #应用实例伸缩组的扩容策略
            "Type":"AWS::AutoScaling::ScalingPolicy",
            "Properties":{
                "AdjustmentType":"ChangeInCapacity",
                "AutoScalingGroupName":{
                    "Ref":"WebServerGroup"
                },
                "Cooldown":"60",                                                                   #扩容策略的冷却时间，单位为秒
                "ScalingAdjustment":{
                    "Ref":"ScalingUpAdj"
                }
            }
        },
        "WebServerScaleDownPolicy":{                                                               #应用实例伸缩组的减容策略
            "Type":"AWS::AutoScaling::ScalingPolicy",
            "Properties":{
                "AdjustmentType":"ChangeInCapacity",
                "AutoScalingGroupName":{
                    "Ref":"WebServerGroup"
                },
                "Cooldown":"60",                                                                   #扩容策略的冷却时间，单位为秒
                "ScalingAdjustment":{
                    "Ref":"ScalingDownAdj"
                }
            }
        },
        "CPUAlarmHigh":{                                                                           #应用实例监控的扩容告警策略
            "Type":"OS::Ceilometer::Alarm",                                                        #告警
            "Properties":{
                "description":"Scale-up",
                "meter_name":"cpu_util",                                                           #监控名称：CPU使用率
                "statistic":"avg",
                "period":"60",                                                                     #告警时间窗口长度，单位为秒
                "evaluation_periods":"1",                                                          #告警时间窗口的数量
                "threshold":{                                                                      #触发告警的门限
                    "Ref":"ScalingUpThre"
                },
                "repeat_actions":true,                                                             #是否重复发送告警信息
                "alarm_actions":[                                                                  #告警触发动作
                    {
                        "Fn::GetAtt":[
                            "WebServerScaleUpPolicy",
                            "AlarmUrl"
                        ]
                    }
                ],
                "matching_metadata":{
                    "metadata.user_metadata.groupname":{                                           #监控对象名称
                        "Ref":"WebServerGroup"
                    }
                },
                "comparison_operator":"gt"
            }
        },
        "CPUAlarmLow":{                                                                            #应用实例监控的减容告警策略
            "Type":"OS::Ceilometer::Alarm",                                                        #告警
            "Properties":{
                "description":"Scale-down",
                "meter_name":"cpu_util",                                                           #监控名称：CPU使用率
                "statistic":"avg",
                "period":"60",                                                                     #告警时间窗口长度，单位为秒
                "evaluation_periods":"1",                                                          #告警时间窗口的数量
                "threshold":{                                                                      #触发告警的门限
                    "Ref":"ScalingDownThre"
                },
                "repeat_actions":true,                                                             #是否重复发送告警信息
                "alarm_actions":[                                                                  #告警触发动作
                    {
                        "Fn::GetAtt":[
                            "WebServerScaleDownPolicy",
                            "AlarmUrl"
                        ]
                    }
                ],
                "matching_metadata":{
                    "metadata.user_metadata.groupname":{                                           #监控对象名称
                        "Ref":"WebServerGroup"
                    }
                },
                "comparison_operator":"lt"
            }
        },
        "LaunchConfig":{                                                                           #应用实例中虚拟机的配置信息
            "Type":"AWS::AutoScaling::LaunchConfiguration",
            "Properties":{
                "ImageId":{                                                                        #应用实例中创建虚拟机使用的镜像
                    "Ref":"ServerImageId"
                },
                "InstanceType":{                                                                   #应用实例中创建虚拟机的规格
                    "Ref":"InstanceType"
                }
            }
        }
    }
}
</pre>
</div>
</div>

</div>

</div>


</body>
</html>
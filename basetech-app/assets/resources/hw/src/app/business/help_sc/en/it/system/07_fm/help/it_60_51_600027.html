
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Restoring a VM">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="it_60_51_600027">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../public_sys-resources/commonltr.css">
<title>Restoring a VM</title>
<script type="text/javascript" language="JavaScript">
//<![CDATA[
function reDo() {
  if (innerWidth != origWidth || innerHeight != origHeight)
     location.reload();
}
if ((parseInt(navigator.appVersion) == 4) && (navigator.appName == "Netscape")) {
	origWidth = innerWidth;
	origHeight = innerHeight;
	onresize = reDo;
}
onerror = null; 
//]]>
</script>
<style type="text/css">
<!--
div.WebHelpPopupMenu { position:absolute;
left:0px;
top:0px;
z-index:4;
visibility:hidden; }
-->
</style>
<script type="text/javascript" language="javascript1.2" src="../../whmsg.js"></script>
<script type="text/javascript" language="javascript" src="../../whver.js"></script>
<script type="text/javascript" language="javascript1.2" src="../../whproxy.js"></script>
<script type="text/javascript" language="javascript1.2" src="../../whutils.js"></script>
<script type="text/javascript" language="javascript1.2" src="../../whlang.js"></script>
<script type="text/javascript" language="javascript1.2" src="../../whtopic.js"></script>

 <meta name="generator" content="Adobe RoboHelp 9">
</head>
<body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px"><script type="text/javascript" language="javascript1.2">//<![CDATA[
<!--
if (window.gbWhTopic)
{
	var strUrl = decodeURI(document.location.href);
	var bc = 0;
	var n = strUrl.toLowerCase().indexOf("bc-");
	if(n != -1)
	{
		document.location.href = encodeURI(strUrl.substring(0, n));
		bc = strUrl.substring(n+3);
	}

	if (window.addTocInfo)
	{
	addTocInfo("FAQ\nRestoring a VM");
addButton("show",BTN_TEXT,"Show","","","","",0,0,"","","");

	}
	if (window.writeBtnStyle)
		writeBtnStyle();

	if (window.writeIntopicBar)
		writeIntopicBar(1);

	
	document.write("<p style=\"text-align:right\"> ");
AddMasterBreadcrumbs("../../Help_User_System.htm", "", ">", "Home", "../father_node/it_60_99_start_cp.html");
document.write("<a href=\"../father_node/it_60_99_faq_cp_01.html\">FAQ<\/a> > Restoring a VM<\/p>");


	if (window.setRelStartPage)
	{
	setRelStartPage("../../Help_User_System.htm");

		autoSync(1);
		sendSyncInfo();
		sendAveInfoOut();
	}
}
else
	if (window.gbIE4)
		document.location.reload();

//-->
//]]></script><a name="it_60_51_600027"></a><a name="it_60_51_600027"></a>


<h1 class="topictitle1">Restoring a VM</h1>
<ul><li><a href="#it_60_51_600027__1.2.1.1">Scenarios</a></li><li><a href="#it_60_51_600027__1.2.2.1">Precautions</a></li><li><a href="#it_60_51_600027__1.2.3.1">Prerequisites</a></li><li><a href="#it_60_51_600027__1.2.4.1">Procedure</a></li></ul>

<div>
<div class="section"><a name="it_60_51_600027__1.2.1.1"></a><a name="1.2.1.1"></a><h4 class="sectiontitle"><a href="#it_60_51_600027" class="sectiontitle2contents">Scenarios</a></h4>


<div class="p"><p>You can perform this operation when a running
VM is faulty, and it cannot be logged in to using VNC. During the
restoration, the system creates a VM using the template and attach
the system disk of the created VM to the faulty VM. The original system
disk of the faulty VM is attached to the created VM as a user disk.
Data in the original system disk will not lose.</p>
</div>

</div>

<div class="section"><a name="it_60_51_600027__1.2.2.1"></a><a name="1.2.2.1"></a><h4 class="sectiontitle"><a href="#it_60_51_600027" class="sectiontitle2contents">Precautions</a></h4>


<div class="p"><div class="p"><ul><li><p>VMs in the VMware hypervisors do not support this function.</p>
</li><li><p>After a VM is restored from a template, software in the VM
template can be used. However, the software installed by users before
the VM restoration cannot be used.</p>
</li><li>After a VM is restored from a template, VM snapshot cannot be
used.</li></ul>
</div>
</div>

</div>

<div class="section"><a name="it_60_51_600027__1.2.3.1"></a><a name="1.2.3.1"></a><h4 class="sectiontitle"><a href="#it_60_51_600027" class="sectiontitle2contents">Prerequisites</a></h4>


<div class="p"><div class="p"><ul><li>You have logged in to <span>ServiceCenter</span>.</li><li>You have created and published VM templates.</li><li>You have obtained information about the number of disks on the
VM to be restored.</li><li>The VM to be restored is created on <span>ServiceCenter</span><span> or <span>FusionCompute</span></span>.</li></ul>
</div>
</div>

</div>

<div class="section"><a name="it_60_51_600027__1.2.4.1"></a><a name="1.2.4.1"></a><h4 class="sectiontitle"><a href="#it_60_51_600027" class="sectiontitle2contents">Procedure</a></h4>

<ul><div class="HandlingTitled"><p class="sectiontitle">Restore the VM.</p>
<div class="Steps-titled"><ol type="1" start="1"><li id="it_60_51_600027__step1"><a name="it_60_51_600027__step1"></a><a name="step1"></a><span>Locate the row that contains the target VM,
and choose <span class="menucascade"><b><span class="uicontrol">More</span></b> &gt; <b><span class="uicontrol">Repair</span></b></span>.</span>
<p><ul><li><p>The <span class="wintitle"><b>Confirm</b></span> dialog box is displayed. Click <span class="parmname"><b>OK</b></span>.</p>
</li><li><p>The <span class="wintitle"><b>Select VM Template</b></span> dialog box is displayed.
Select the template for repairing the VM and click <span class="parmname"><b>Restore</b></span>.</p>
</li></ul>
</p>
</li><li><span>Click the restored VM in the VM list.</span></li><li id="it_60_51_600027__step8"><a name="it_60_51_600027__step8"></a><a name="step8"></a><span>On the <span class="uicontrol"><b>Hardware</b></span> page,
check the number of disks on the VM when the VM state changes to <span class="parmname"><b>Running</b></span>.</span>
<p><ul><li>If the number of disks on the VM increases, the VM is restored
successfully. Go to <a href="#it_60_51_600027__xiufu">4</a>.</li><li>If the number of disks on the VM does not increase, repeat <a href="#it_60_51_600027__step1">1</a> to <a href="#it_60_51_600027__step8">3</a>.</li></ul>
</p>
</li><li id="it_60_51_600027__xiufu"><a name="it_60_51_600027__xiufu"></a><a name="xiufu"></a><span>Inform the VM user that the VM has been restored
and the VM disks must be restored.</span></li><li><span>The user logs in to the VM and performs operations based
on the OS type of the VM.</span>
<p><ul><li>If the VM runs the Windows OS, go to <a href="#it_60_51_600027__windows">6</a>.</li><li>If the VM runs the Linux OS, go to <a href="#it_60_51_600027__linux">10</a>.</li></ul>
</p>
</li></ol></div>
</div>
<div class="HandlingTitled"><p class="sectiontitle">Restore disks for a Windows VM.</p>
<p>In this example, the VM runs Windows 7.</p><div class="Steps-titled"><ol type="1" start="6"><li id="it_60_51_600027__windows"><a name="it_60_51_600027__windows"></a><a name="windows"></a><span>On the task bar of the VM, click <span class="uicontrol"><b>Start</b></span>, right-click <span class="uicontrol"><b>Computer</b></span>, and
choose <span class="menucascade"><b><span class="uicontrol">Manage</span></b></span>. </span>
</li><li><span>In the navigation tree on the left, choose <span class="menucascade"><b><span class="uicontrol">Disk Management</span></b></span>. </span></li><li><span>On the lower part of the pane in the middle of the displayed
page, right-click the disk whose state is <span class="parmname"><b>Offline</b></span> and choose <span class="menucascade"><b><span class="uicontrol">Online</span></b></span>. </span></li><li><span>The <span class="wintitle"><b>Computer management</b></span> page is
displayed.</span>
<p>The restored disks are displayed in the <span class="wintitle"><b>Computer</b></span> area. No further action is required.</p>
</li></ol></div>
</div>
<div class="HandlingTitled"><p class="sectiontitle">Restore disks for a Linux VM.</p>
<div class="Steps-titled"><ol type="1" start="10"><li id="it_60_51_600027__linux"><a name="it_60_51_600027__linux"></a><a name="linux"></a><span>Right-click on the blank area of the VM desktop
and choose <span class="menucascade"><b><span class="uicontrol">Open in Terminal</span></b></span>.</span></li><li><span>Run the following command to query data disk information:</span>
<p><p><b><span class="cmdname">fdisk -l</span></b></p>
</p>
</li><li><span>Run the following command to create a directory:</span>
<p><p><b><span class="cmdname">mkdir </span></b><i><span class="varname">Directory name</span></i></p>
<p>For example, <b><span class="cmdname">mkdir </span></b><i><span class="varname">repair</span></i></p>
</p>
</li><li><span>Run the following command to mount the disk to the created
directory:</span>
<p><p><b><span class="cmdname">mount </span></b><i><span class="varname">Data disk </span></i><i><span class="varname">Directory name</span></i></p>
<p>For example, <b><span class="cmdname">mount </span></b><i><span class="varname">/dev/xvdf2 </span></i><i><span class="varname">repair</span></i></p>
<div class="note"><img src="../../public_sys-resources/icon-note.gif"><span class="notetitle"> NOTE: </span><div class="notebody"><ul><li>The disk cannot be mounted to the created directory if the disk
has not been partitioned or formatted or has been mounted to another
VM.</li><li>Users may need to mount the disk several times before the disk
is detected.</li></ul>
</div></div>
</p>
</li><li><span>Run the following command to query data disk information:</span>
<p><p><b><span class="cmdname">cd </span></b><i><span class="varname">Directory name</span></i></p>
<p>For example, <b><span class="cmdname">cd </span></b><i><span class="varname">repair</span></i></p>
<div class="note"><img src="../../public_sys-resources/icon-note.gif"><span class="notetitle"> NOTE: </span><div class="notebody">The drive letter of the restored disk may change.</div></div>
</p>
</li></ol></div>
</div>
<a name="it_60_51_600027__net"></a><a name="net"></a><div class="HandlingTitled" id="it_60_51_600027__net"><p class="sectiontitle">Restore network configuration
for a Linux VM.</p>
<p>If the VM NIC obtains an IP address in static injection mode,
the serial number of the NIC may change and become inconsistent with
the name of the NIC configuration file after the VM is restored. As
a result, the IP address of the NIC may be lost. Therefore, you must
restore the NIC configuration file by performing the following operations:</p><div class="Steps-titled"><ol type="1" start="15"><li><span>On the VM page, right-click in the blank area of the
VM desktop and choose <span class="uicontrol"><b>Open in Terminal</b></span>.</span>
</li><li><span>Run the following command to query the MAC address of
the NIC:</span>
<p><p><b><span class="cmdname">ifconfig -a</span></b></p>
<p>In the command output, <span class="parmname"><b>HWaddr</b></span> to the right of the NIC serial number indicates
the MAC address. Make a note of the serial number and the <span class="parmname"><b>HWaddr</b></span> value for each NIC. For example, the <span class="parmname"><b>HWaddr</b></span> value to the right of NIC <span class="parmvalue"><b>eth3</b></span> is <span class="parmvalue"><b>28:6E:D4:88:C7:B0</b></span>.</p>
</p>
</li><li><span>Run the following commands to query the name of the
NIC configuration file:</span>
<p><p><b><span class="cmdname">cd /etc/sysconfig/network</span></b></p>
<p><b><span class="cmdname">ls</span></b></p>
<p>The file that contains <span class="parmvalue"><b>ifcfg-eth*</b></span> in the file name, for example, <span class="parmvalue"><b>ifcfg-eth2</b></span>, is a NIC configuration file.</p>
</p>
</li><li><span>Run the following command to query the IP address recorded
in the NIC configuration file:</span>
<p><p><b><span class="cmdname">cat </span></b><i><span class="varname">Name of the NIC configuration
file </span></i></p>
<p>For example, run the following command to query
the IP address recorded in the <span class="parmvalue"><b>ifcfg-eth2</b></span> file:</p>
<p><b><span class="cmdname">cat ifcfg-eth2</span></b></p>
</p>
</li><li><span>Determine whether the serial number of the NIC on the
restored VM changes by checking the following data:</span>
<p><ul><li>NIC configuration file name and the IP address recorded in the
file</li><li>NIC serial number and IP address corresponding to the MAC address
that is displayed for the <span class="parmname"><b>HWaddr</b></span> parameter before
the VM is restored. To query the mapping between the IP address and
the MAC address, log in to <span>ServiceCenter</span>, switch to the <span class="wintitle"><b>Summary</b></span> page, and choose <span class="menucascade"><b><span class="uicontrol">More</span></b> &gt; <b><span class="uicontrol">Initial Network Configuration</span></b></span>.</li></ul>
<div class="p">For example:<ul><li>The NIC configuration file name is <span class="parmvalue"><b>ifcfg-eth2</b></span>, and the IP address recorded in the file is <span class="parmvalue"><b>192.168.10.136</b></span>.</li><li>The <span class="parmname"><b>HWaddr</b></span> value of NIC <span class="parmvalue"><b>eth3</b></span> is <span class="parmvalue"><b>28:6E:D4:88:C7:B0</b></span>, and the IP address
corresponding to this MAC address is <span class="parmvalue"><b>192.168.10.136</b></span> in <span class="uicontrol"><b>Initial Network Configuration</b></span>.</li></ul>
</div>
<p>This indicates that NIC <span class="parmvalue"><b>eth2</b></span> of
the VM changes to <span class="parmvalue"><b>eth3</b></span> after the VM is restored.</p>
</p>
</li><li><span>Run the following command to copy the NIC configuration
file to the <span class="filepath"><b>/etc/sysconfig/network</b></span> directory
and rename the file based on the new serial number:</span>
<p><p><b><span class="cmdname">cp</span></b><i><span class="varname"> Name of the original NIC configuration
file</span></i><i><span class="varname"> Name of the new NIC configuration file</span></i></p>
<p>For example, run the following command to copy the <span class="parmvalue"><b>ifcfg-eth2</b></span> file to the <span class="filepath"><b>/etc/sysconfig/network</b></span> directory and rename it <span class="parmvalue"><b>ifcfg-eth3</b></span>:</p>
<p><b><span class="cmdname">cp ifcfg-eth2 ifcfg-eth3</span></b></p>
</p>
</li><li><span>Run the following command to restart the network on
the VM:</span>
<p><p><b><span class="cmdname">service network restart</span></b></p>
</p>
</li></ol></div>
</div>
<a name="it_60_51_600027__install"></a><a name="install"></a><div class="HandlingTitled" id="it_60_51_600027__install"><p class="sectiontitle">Follow-up Procedure</p>
<p>After a VM is restored, the system disk of the faulty VM will
be mounted to the restored VM as a user disk. Software installed on
the faulty VM may become unavailable because of the system registry.
Therefore, reinstall the software on the restored VM.</p></div>
</ul>

</div>

</div>


<div class="hrcopyright"><hr size="2"></div><div class="hwcopyright">Huawei Proprietary and Confidential</div><div class="hwcopyright">Copyright &copy; Huawei Technologies Co., Ltd.</div><script type="text/javascript" language="javascript1.2">//<![CDATA[
<!--
if (window.writeIntopicBar)
	writeIntopicBar(0);


highlightSearch();
//-->
//]]></script>
</body>
</html>
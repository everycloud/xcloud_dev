<div class="role_detail" ng-controller="userMgr.role.detail.ctrl">
    <div class="container-fluid">
        <div class="row-fluid innerbox-padding">
            <div class="span4">
                <div class="inner-legend" ng-bind="i18n.common_term_basicInfo_label"></div>
                <tiny-formfield class="margin-top-beautifier">
                    <tiny-item label="name.label">
                        <span ng-bind="name.value"></span>
                    </tiny-item>
                    <tiny-item label="description.label">
                        <span class="autoWrap" ng-bind="description.value"></span>
                    </tiny-item>
                </tiny-formfield>
            </div>
            <div class="span4">
                <div style="border: 1px #ccc solid;overflow-y:auto;overflow-x:hidden;">
                    <tiny-tree id="roleTree.id" height="roleTree.height" setting="roleTree.setting"
                               values="roleTree.values"></tiny-tree>
                </div>
            </div>
            <div class="span4">
                <div class="inner-legend none-line" ng-bind="i18n.common_term_users_label"></div>
                <tiny-table id="userModel.id" data="userModel.datas" columns="userModel.columns" enable-pagination="userModel.pagination"></tiny-table>
            </div>
        </div>
    </div>
    <script>
    require(["jquery",
            "app/business/tenantUser/controllers/role/roleDetailCtrl"
        ],
        function($, roleDetailCtrl) {

            //替换ID，使ID唯一
            var lineNum = $(".role_detail").parent().parent().parent().prev().attr("lineNum");
            var roleId = $(".role_detail").parent().parent().parent().prev().attr("roleId");
            var domId = "roleDetail" + lineNum;
            var className = "role_detail" + lineNum;

            // 1.获取当前Dom
            var curView = undefined;
            $(".role_detail").each(function() {
                if ($(this).attr("id") === undefined) {
                    curView = $(this);
                }
            });

            curView.attr("id", domId);
            curView.attr("class", className);

            // 2.编译
            var scope = curView.scope();
            var modules = ["wcc", roleDetailCtrl.name];
            modules.unshift(["$provide",
                function($provide) {
                    $provide.value("$rootElement", curView);
                }
            ]);
            modules.unshift("ng");
            var $injector = angular.injector(modules);
            $injector.invoke(["$compile",
                function($compile) {
                    $compile(curView)(scope);
                    scope.$digest();
                }
            ]);

            // 3.初始化scope
            var newScope = curView.scope();
            newScope.$apply(function() {
                newScope.roleId = roleId;
                newScope.operator.getRoleDetail();
            });
        });
    </script>

<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="zh-cn" xml:lang="zh-cn">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=gb2312">
   
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
<meta name="copyright" content="(C) 版权 2005">
<meta name="DC.rights.owner" content="(C) 版权 2005">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="NAT">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="it_60_51_000011">
<meta name="DC.Language" content="zh-cn">
<link rel="stylesheet" type="text/css" href="../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../public_sys-resources/ExpandCollapse.js"></script>
<title>NAT</title>
</head>
<body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px"><a name="it_60_51_000011"></a><a name="it_60_51_000011"></a>


<h1 class="topictitle1">NAT</h1>


<div>
<div class="section" id="it_60_51_000011__sec_overView"><a name="it_60_51_000011__sec_overView"></a><a name="sec_overView"></a><h4 class="sectiontitle">简介</h4><p id="it_60_51_000011__nat_define"><a name="it_60_51_000011__nat_define"></a><a name="nat_define"></a>NAT（Network
Address Translation）用于实现内部的私有IP地址和公网IP地址之间的转换。与弹性IP业务不同，NAT在实现私有网络与公网互联的同时节约了IP地址资源，解决了公网IP地址资源不足的问题。</p>
</div>

<div class="section" id="it_60_51_000011__sec_principle"><a name="it_60_51_000011__sec_principle"></a><a name="sec_principle"></a><h4 class="sectiontitle">原理概述</h4><p><strong>DNAT</strong></p>
<p>DNAT是目的地址转换，其作用是将一组本地私有IP地址映射到公网IP地址，主要用于内部服务对外发布。</p>
<p>如果公司内网使用的都是私有IP地址，只有网络出口使用的是公网IP地址，当公司中的一些使用私有IP地址的服务器需要对外提供服务时，由于公网上没有到达服务器的路由，所以公网用户是无法访问服务器的。</p>
<div class="p">通过路由器将公网IP地址映射给服务器，当公网用户访问私有网络中的服务器时，可以直接访问路由器上的公网IP地址，路由器会把公网IP地址（目的地址）转换为服务器的私有IP地址，实现公网用户对私有网络中服务器的访问，如<a href="#it_60_51_000011__fig_dnat">图1</a>。<div class="fignone" id="it_60_51_000011__fig_dnat"><a name="it_60_51_000011__fig_dnat"></a><a name="fig_dnat"></a><span class="figcap"><b>图1 </b>DNAT</span>

<br><span><img src="fig/fig_it_60_51_000011_3.png"></span></div>
</div>
<p><strong>SNAT</strong></p>
<p>SNAT是源地址转换，其作用是将IP数据包的源地址转换成另外一个地址，主要用于内部共享公网IP地址访问外部。</p>
<p>如果公司内网使用的都是私有IP地址，网络出口使用公网IP地址来支持公司的外网访问，公司内网的用户要访问外网的服务器时，数据包会根据网络上的路由一直发送到服务器，在服务器返回数据包时，由于公网上没有到达私有IP地址的路由，会导致用户访问超时。</p>
<p>为了使数据包的正确发送及返回，在用户访问外网的服务器时，路由器将内网的私有IP地址（源地址）转换为一个公网IP地址，然后和服务器通信。当服务器返回数据包时，先把数据包发送给路由器，路由器再把数据转发给内网用户。这样就实现了私有网络中用户访问外网的资源。</p>
</div>

<div class="section"><h4 class="sectiontitle">需要准备的软件</h4><p>通过软件路由器实现NAT功能时，需要获取<a href="#it_60_51_000011__tbl_01">表1</a>中的软件。</p>

<div class="tablenoborder"><a name="it_60_51_000011__tbl_01"></a><a name="tbl_01"></a><table cellpadding="4" cellspacing="0" summary="" id="it_60_51_000011__tbl_01" frame="border" border="1" rules="all"><caption><b>表1 </b>软件</caption>
<thead align="left">
<tr>
<th class="cellrowborder" valign="top" width="23%" id="mcps1.2.3.3.2.4.1.1"><p>名称</p>
</th>

<th class="cellrowborder" valign="top" width="35.75%" id="mcps1.2.3.3.2.4.1.2"><p>说明</p>
</th>

<th class="cellrowborder" valign="top" width="41.25%" id="mcps1.2.3.3.2.4.1.3"><p>获取方式</p>
</th>

</tr>

</thead>

<tbody>
<tr>

<td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.3.2.4.1.1 "><span class="filepath">“FusionCompute V100R005C00SPC200_VSA.zip”</span></td>

<td class="cellrowborder" valign="top" width="35.75%" headers="mcps1.2.3.3.2.4.1.2 "><p>系统服务虚拟机模板文件，申请软件路由器时，系统会自动通过此模板文件创建系统服务虚拟机，提供路由器功能。</p>
</td>

<td class="cellrowborder" valign="top" width="41.25%" headers="mcps1.2.3.3.2.4.1.3 "><div class="p" id="it_60_51_000011__d760e114"><a name="it_60_51_000011__d760e114"></a><a name="d760e114"></a><ul><li><p>企业用户：<span class="menucascade">“<span class="uicontrol">http://support.huawei.com/enterprise </span> &gt; <span class="uicontrol">软件下载</span> &gt; <span class="uicontrol">IT</span> &gt; <span class="uicontrol">云计算</span> &gt; <span class="uicontrol">云操作系统</span> &gt; <span class="uicontrol">FusionCompute</span> &gt; <span class="uicontrol">V100R005C00SPC100</span>”</span></p>
</li><li><p>运营商用户：<span class="menucascade">“<span class="uicontrol">http://support.huawei.com</span> &gt; <span class="uicontrol">产品软件</span> &gt; <span class="uicontrol">电信软件与核心网</span> &gt; <span class="uicontrol">电信云计算</span> &gt; <span class="uicontrol">IT云基础设施解决方案</span> &gt; <span class="uicontrol">Cloud
OS</span> &gt; <span class="uicontrol">FusionCompute</span> &gt; <span class="uicontrol">V100R005C00SPC100</span>”</span></p>
</li></ul>
</div>
</td>

</tr>

</tbody>

</table>
</div>
<div class="note"><img src="../theme/default/images/icon-note.gif"><span class="notetitle"> 说明： </span><div class="notebody">获取到软件包后建议先执行软件包校验的操作，具体操作请参见<a href="../soft_inst/it_60_23_000021.html">校验软件包</a>。</div></div>
</div>

<div class="section"><h4 class="sectiontitle">配置流程</h4><p><span>FusionManager</span>是通过路由器实现DNAT和SNAT功能的，因此在配置DNAT和SNAT时，要先为配置路由器，并创建路由网络。</p>
<p>基于硬件路由器的DNAT和SNAT功能配置流程如<a href="#it_60_51_000011__fig_hardNAT">图2</a>所示。</p>
<div class="fignone" id="it_60_51_000011__fig_hardNAT"><a name="it_60_51_000011__fig_hardNAT"></a><a name="fig_hardNAT"></a><span class="figcap"><b>图2 </b>基于硬件路由器的NAT配置流程</span>

<br><span><img src="fig/fig_it_60_51_000011_1.png"></span></div>
<p>配置流程中的各任务说明如<a href="#it_60_51_000011__tab_02">表2</a>所示。</p>

<div class="tablenoborder"><a name="it_60_51_000011__tab_02"></a><a name="tab_02"></a><table cellpadding="4" cellspacing="0" summary="" id="it_60_51_000011__tab_02" frame="border" border="1" rules="all"><caption><b>表2 </b>任务说明</caption>
<thead align="left">
<tr>
<th class="cellrowborder" valign="top" width="22.135416666666664%" id="mcps1.2.4.6.2.4.1.1"><p>任务</p>
</th>

<th class="cellrowborder" valign="top" width="44.27083333333333%" id="mcps1.2.4.6.2.4.1.2"><p>说明</p>
</th>

<th class="cellrowborder" valign="top" width="33.59375%" id="mcps1.2.4.6.2.4.1.3"><p>界面入口</p>
</th>

</tr>

</thead>

<tbody>
<tr>

<td class="cellrowborder" valign="top" width="22.135416666666664%" headers="mcps1.2.4.6.2.4.1.1 "><p>接入防火墙设备</p>
</td>

<td class="cellrowborder" valign="top" width="44.27083333333333%" headers="mcps1.2.4.6.2.4.1.2 "><p>硬件类型的路由器能够提供弹性IP、NAT、ACLs、应用层包过滤和VPN功能，在使用这些功能之前，需要在防火墙设备上创建虚拟防火墙实例，并将防火墙设备接入到<span>FusionManager</span>，以便通过<span>FusionManager</span>对防火墙进行配置和管理。</p>
</td>

<td class="cellrowborder" valign="top" width="33.59375%" headers="mcps1.2.4.6.2.4.1.3 "><p><span class="menucascade">“<span class="uicontrol">资源</span> &gt; <span class="uicontrol">设备</span> &gt; <span class="uicontrol">网络设备</span> &gt; <span class="uicontrol">防火墙</span>”</span></p>
</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="22.135416666666664%" headers="mcps1.2.4.6.2.4.1.1 "><p>添加VLAN池并关联DVS</p>
</td>

<td class="cellrowborder" valign="top" width="44.27083333333333%" headers="mcps1.2.4.6.2.4.1.2 "><p>将规划的路由网络的VLAN，添加到<span>FusionManager</span>的VLAN池，并为其关联DVS。</p>
</td>

<td class="cellrowborder" valign="top" width="33.59375%" headers="mcps1.2.4.6.2.4.1.3 ">在<span class="menucascade">“<span class="uicontrol">资源</span> &gt; <span class="uicontrol">资源分区</span>”</span>界面，选择一个资源分区，选择<span class="menucascade">“<span class="uicontrol">网络资源池</span> &gt; <span class="uicontrol">VLAN池</span>”</span>。</td>

</tr>

<tr>

<td class="cellrowborder" valign="top" width="22.135416666666664%" headers="mcps1.2.4.6.2.4.1.1 "><p>添加公网IP地址池</p>
</td>

<td class="cellrowborder" valign="top" width="44.27083333333333%" headers="mcps1.2.4.6.2.4.1.2 "><p id="it_60_51_000011__p_publicIP"><a name="it_60_51_000011__p_publicIP"></a><a name="p_publicIP"></a>公网IP地址池是对<span>FusionManager</span>所使用的公网IP地址进行管理的资源池，配置DNAT和SNAT业务时使用的公网IP地址，从公网IP地址池中获取。</p>
</td>

<td class="cellrowborder" valign="top" width="33.59375%" headers="mcps1.2.4.6.2.4.1.3 ">在<span class="menucascade">“<span class="uicontrol">资源</span> &gt; <span class="uicontrol">资源分区</span>”</span>界面，选择一个资源分区，选择<span class="menucascade">“<span class="uicontrol">网络资源池</span> &gt; <span class="uicontrol">公网IP地址池</span>”</span>。</td>

</tr>

<tr>

<td class="cellrowborder" valign="top" width="22.135416666666664%" headers="mcps1.2.4.6.2.4.1.1 "><p>配置DNAT参数</p>
</td>

<td class="cellrowborder" valign="top" width="44.27083333333333%" headers="mcps1.2.4.6.2.4.1.2 "><p id="it_60_51_000011__p_napt"><a name="it_60_51_000011__p_napt"></a><a name="p_napt"></a>使用DNAT功能时执行该任务。为<span>FusionManager</span>配置DNAT业务使用的公网起始端口、结束端口。配置公网访问虚拟机时长，当公网访问虚拟机达到该时长后，会自动断开，继续访问虚拟机时需要重新建立连接。</p>
</td>

<td class="cellrowborder" valign="top" width="33.59375%" headers="mcps1.2.4.6.2.4.1.3 ">在<span class="menucascade">“<span class="uicontrol">资源</span> &gt; <span class="uicontrol">资源分区</span>”</span>界面，选择一个资源分区，选择<span class="menucascade">“<span class="uicontrol">网络资源池</span> &gt; <span class="uicontrol">虚拟防火墙</span>”</span>。</td>

</tr>

</tbody>

</table>
</div>
<p>基于软件路由器的DNAT和SNAT功能配置流程如<a href="#it_60_51_000011__fig_softNAT">图3</a>所示。</p>
<div class="fignone" id="it_60_51_000011__fig_softNAT"><a name="it_60_51_000011__fig_softNAT"></a><a name="fig_softNAT"></a><span class="figcap"><b>图3 </b>基于软件路由器的NAT配置流程</span>

<br><span><img src="fig/fig_it_60_51_000011_2.png"></span></div>
<p>配置流程中的各任务说明如<a href="#it_60_51_000011__tab_01">表3</a>所示。</p>

<div class="tablenoborder"><a name="it_60_51_000011__tab_01"></a><a name="tab_01"></a><table cellpadding="4" cellspacing="0" summary="" id="it_60_51_000011__tab_01" frame="border" border="1" rules="all"><caption><b>表3 </b>任务说明</caption>


<thead align="left">
<tr>
<th class="cellrowborder" valign="top" width="20.77922077922078%" id="mcps1.2.4.10.2.4.1.1"><p>任务</p>
</th>

<th class="cellrowborder" valign="top" width="41.2987012987013%" id="mcps1.2.4.10.2.4.1.2"><p>说明</p>
</th>

<th class="cellrowborder" valign="top" width="37.92207792207792%" id="mcps1.2.4.10.2.4.1.3"><p>参考内容</p>
</th>

</tr>

</thead>

<tbody>
<tr>
<td class="cellrowborder" valign="top" width="20.77922077922078%" headers="mcps1.2.4.10.2.4.1.1 "><p>安装并接入VSAM</p>
</td>

<td class="cellrowborder" valign="top" width="41.2987012987013%" headers="mcps1.2.4.10.2.4.1.2 "><p>使用系统服务虚拟机，为系统提供软件路由器、软件负载均衡以及DHCP服务等服务时，要求使用<span>FusionCompute</span>虚拟化环境，并在虚拟化环境中部署VSAM节点，该节点用来对系统服务虚拟机进行配置和管理。</p>
</td>

<td class="cellrowborder" valign="top" width="37.92207792207792%" headers="mcps1.2.4.10.2.4.1.3 "><p><strong>安装VSAM</strong></p>
<p><span>《<span>FusionManager V100R005C00
软件安装指南</span>》</span>中的<span class="wintitle">“安装VSAM”</span>。</p>
<p><strong>修改虚拟化环境</strong></p>
<span class="menucascade">“<span class="uicontrol">资源</span> &gt; <span class="uicontrol">虚拟化环境</span>”</span></td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="20.77922077922078%" headers="mcps1.2.4.10.2.4.1.1 "><p>添加VLAN池并关联DVS</p>
</td>

<td class="cellrowborder" valign="top" width="41.2987012987013%" headers="mcps1.2.4.10.2.4.1.2 "><div class="p">需要在VLAN池中添加以下网络的VLAN信息:<ul><li>路由网络的VLAN，该路由网络用来部署业务虚拟机。</li><li>外部网络的VLAN，该外部网络用来连接软件路由器。</li></ul>
</div>
</td>

<td class="cellrowborder" valign="top" width="37.92207792207792%" headers="mcps1.2.4.10.2.4.1.3 ">在<span class="menucascade">“<span class="uicontrol">资源</span> &gt; <span class="uicontrol">资源分区</span>”</span>界面，选择一个资源分区，选择<span class="menucascade">“<span class="uicontrol">网络资源池</span> &gt; <span class="uicontrol">VLAN池</span>”</span>。</td>

</tr>

<tr>

<td class="cellrowborder" valign="top" width="20.77922077922078%" headers="mcps1.2.4.10.2.4.1.1 "><p>添加外部网络</p>
</td>

<td class="cellrowborder" valign="top" width="41.2987012987013%" headers="mcps1.2.4.10.2.4.1.2 "><p>本任务中的外部网络用于连接软件路由器，为路由网络中关联的虚拟机访问公网提供公网IP地址资源。在<span>FusionManager</span>上创建外部网络时要求能够连接到Internet，且子网的分配方式为静态注入，子网类型为普通。</p>
</td>

<td class="cellrowborder" valign="top" width="37.92207792207792%" headers="mcps1.2.4.10.2.4.1.3 ">在<span class="menucascade">“<span class="uicontrol">资源</span> &gt; <span class="uicontrol">资源分区</span>”</span>界面，选择一个资源分区，选择<span class="menucascade">“<span class="uicontrol">网络资源池</span> &gt; <span class="uicontrol">外部网络</span>”</span>。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="20.77922077922078%" headers="mcps1.2.4.10.2.4.1.1 "><p>添加VSA管理网络</p>
</td>

<td class="cellrowborder" valign="top" width="41.2987012987013%" headers="mcps1.2.4.10.2.4.1.2 "><div class="p">VSA管理网络用来为系统服务虚拟机提供管理平面网络，其配置要求如下：<ul><li>VSA管理网络与系统管理平面互通。</li><li>VSA管理网络的VLAN要添加到FusionCompute的分布式交换机中，但在<span>FusionManager</span>的VLAN池中不能包含此VLAN。</li></ul>
</div>
</td>

<td class="cellrowborder" valign="top" width="37.92207792207792%" headers="mcps1.2.4.10.2.4.1.3 ">在<span class="menucascade">“<span class="uicontrol">资源</span> &gt; <span class="uicontrol">资源分区</span>”</span>界面，选择一个资源分区，选择<span class="menucascade">“<span class="uicontrol">网络资源池</span> &gt; <span class="uicontrol">VSA网络</span>”</span>。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="20.77922077922078%" headers="mcps1.2.4.10.2.4.1.1 "><p>配置DNAT参数</p>
</td>

<td class="cellrowborder" valign="top" width="41.2987012987013%" headers="mcps1.2.4.10.2.4.1.2 "><p>使用DNAT功能时执行该任务。为<span>FusionManager</span>配置DNAT业务使用的公网起始端口、结束端口。配置公网访问虚拟机时长，当公网访问虚拟机达到该时长后，会自动断开，继续访问虚拟机时需要重新建立连接。</p>
</td>

<td class="cellrowborder" valign="top" width="37.92207792207792%" headers="mcps1.2.4.10.2.4.1.3 ">在<span class="menucascade">“<span class="uicontrol">资源</span> &gt; <span class="uicontrol">资源分区</span>”</span>界面，选择一个资源分区，选择<span class="menucascade">“<span class="uicontrol">网络资源池</span> &gt; <span class="uicontrol">虚拟防火墙</span>”</span>。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="20.77922077922078%" headers="mcps1.2.4.10.2.4.1.1 "><p>导入VSA虚拟机模板</p>
</td>

<td class="cellrowborder" valign="top" width="41.2987012987013%" headers="mcps1.2.4.10.2.4.1.2 "><p>VSA虚拟机模板为系统自动创建系统服务虚拟机提供模板资源。</p>
</td>

<td class="cellrowborder" valign="top" width="37.92207792207792%" headers="mcps1.2.4.10.2.4.1.3 "><span class="menucascade">“<span class="uicontrol">资源</span> &gt; <span class="uicontrol">模板和规格</span> &gt; <span class="uicontrol">虚拟机模板</span>”</span></td>

</tr>

</tbody>

</table>
</div>
</div>

</div>


</body>
</html>
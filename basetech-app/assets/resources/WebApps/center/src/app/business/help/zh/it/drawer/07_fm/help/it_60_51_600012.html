
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="zh-cn" xml:lang="zh-cn">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=gb2312">
   
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
<meta name="copyright" content="(C) 版权 2005">
<meta name="DC.rights.owner" content="(C) 版权 2005">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="如何接入防火墙设备">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="it_60_51_600012">
<meta name="DC.Language" content="zh-cn">
<link rel="stylesheet" type="text/css" href="../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../public_sys-resources/ExpandCollapse.js"></script>
<title>如何接入防火墙设备</title>
</head>
<body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px"><a name="it_60_51_600012"></a><a name="it_60_51_600012"></a>



<h1 class="topictitle1">如何接入防火墙设备</h1>

<div>
<div class="section"><h4 class="sectiontitle">操作场景</h4>


<div class="p"><p>将物理防火墙设备接入<span>FusionManager</span>上，以实现对防火墙的监控、管理和业务配置。</p>
</div>

</div>

<div class="section"><h4 class="sectiontitle">前提条件</h4>


<div class="p"><ul><li>已登录<span>FusionManager</span>。</li><li>已在物理防火墙上配置执行该任务所需的数据，包括SSH用户和密码、SNMP信息，具体配置请参考防火墙的相关产品文档。</li></ul>
</div>

</div>

<div class="section"><h4 class="sectiontitle">配置前检查</h4>


<div class="p">若待接入的防火墙型号为<span class="parmvalue">“Eudemon8000E V200R001C01”</span>，且为主备配置时，请在接入防火墙之前进行配置检查。</div>

<ol><li><span>分别登录主备防火墙执行<b><span class="cmdname">hrp auto-sync config</span></b>命令，开启自动同步功能。</span>
</li><li><span>禁止主备防火墙开启配置镜像。</span>
<p><ol type="a"><li><p>执行<b><span class="cmdname">display current-configuration | include hrp</span></b>命令查看当前状态。</p>
<p>当回显中含有以下信息时，说明开启了配置镜像。</p>
<pre class="screen">hrp mirror config enable</pre>
</li><li><p>分别登录主备防火墙执行<b><span class="cmdname">undo hrp mirror config enable</span></b>命令，删除配置镜像。</p>
</li></ol>
</p>
</li><li><span>检查防火墙主备状态、心跳状态。</span>
<p><ol type="a"><li><p>执行<b><span class="cmdname">display hrp state</span></b>命令，查看防火墙主备状态。</p>
<p>以主防火墙为例，当回显信息如下时，说明主防火墙状态正常。</p>
<pre class="screen"><strong>Role: active, peer: standby</strong>
Running priority: 47008, peer: 47008
<strong>Core state: normal, peer: normal</strong>
Backup channel usage: 0%
Stable time: 0 days, 2 hours, 51 minutes</pre>
</li><li><p>执行<b><span class="cmdname">display hrp interface</span></b>命令，检查心跳状态。</p>
<p>当回显信息如下时，说明主备心跳状态正常。</p>
<pre class="screen">Eth-Trunk4 : running</pre>
</li></ol>
</p>
</li><li><span>检查防火墙是否发生倒换，如果发生主备倒换，请根据防火墙相关产品文档恢复主备关系。</span></li></ol>

</div>

<div class="section"><h4 class="sectiontitle">操作步骤</h4>

<ol><li><span>在<span>FusionManager</span>上，选择<span class="menucascade">“<span class="uicontrol">资源</span> &gt; <span class="uicontrol">设备</span> &gt; <span class="uicontrol">网络设备</span> &gt; <span class="uicontrol">防火墙</span>”</span>。</span></li><li><span>单击<span class="uicontrol">“接入防火墙”</span>。</span>
<p>进入<span class="wintitle">“接入防火墙”</span>页面。</p>
</li><li><span>配置防火墙基本信息。</span>
<p><ul><li>接入方式：若接入的防火墙为单机部署则选择<span class="uicontrol">“单设备接入”</span>；若为主备部署则选择<span class="uicontrol">“主备设备接入”</span>。</li><li>资源分区：防火墙设备所属的资源分区。</li><li>用户名：在物理防火墙上创建的SSH用户。</li><li>密码：SSH用户的密码。</li><li>确认密码：重新输入SSH用户的密码。</li><li>端口：接入防火墙设备所使用的端口，默认为<span class="parmvalue">“22”</span>。</li><li>组网类型：<ul><li>ospf：物理防火墙中的虚拟防火墙会发起广播，使得汇聚交换机可应用动态路由学习功能自动获取回程路由，无需手动进行路由配置，如<a href="#it_60_51_600012__fig_01">图1</a>所示橙色和蓝色线。路由和回程路由是相对的，如虚拟机到Internet的通讯路径为路由，那么从Internet到虚拟机的通讯路径即为回程路由，即图中蓝色虚线所示。</li><li>static-route：目前该类型仅支持华为S6324、S9300和CE12800型号的交换机。若虚拟防火墙使用较多时，建议使用该组网类型，以避免虚拟防火墙发起过多广播导致汇聚交换机过载，性能低下。资源分区的组网方式为“网关在交换机并管理防火墙”时，只能使用该组网类型。若使用该类型，则：<ol type="a"><li>需将汇聚交换机接入<span>FusionManager</span>，以便<span>FusionManager</span>对其进行路由配置。</li><li><span>FusionManager</span>会自动使用汇聚交换机的根路由和虚拟防火墙的untrust域，将弹性IP、DNAT和SNAT业务的回程路由配通，无需手动配置静态路由。若不使用根路由，则需手动配置静态路由，如<a href="#it_60_51_600012__fig_01">图1</a>所示蓝色线。</li><li>若除弹性IP、DNAT和SNAT业务之外，还需使用路由网络连接其他设备，如<a href="#it_60_51_600012__fig_01">图1</a>所示橙色线，则需手动配置静态路由，具体操作方法请参考本任务中的<span class="parmname">“后续任务”</span>。</li></ol>
<div class="fignone" id="it_60_51_600012__fig_01"><a name="it_60_51_600012__fig_01"></a><a name="fig_01"></a><span class="figcap"><b>图1 </b>组网类型</span>

<br><span><img src="fig/fig_it_60_51_600012_01.png"></span><br>
</div>
</li></ul>
</li><li>IP：物理防火墙的管理IP地址。</li><li>机房：防火墙设备所在的机房名称。</li><li>机柜：防火墙设备所在的机柜号。</li><li>机框：防火墙设备所在的机框号。</li></ul>
</p>
</li><li><span>单击<span class="uicontrol">“下一步”</span>。</span></li><li><span>配置防火墙SNMP接入参数。</span>
<p><div class="note"><img src="../theme/default/images/icon-note.gif"><span class="notetitle"> 说明： </span><div class="notebody"><div class="p"><ul><li>SNMPv3认证协议支持的HMACMD5，HMACSHA，两者均为不安全算法。建议用户选择安全性高的HMACSHA（HMACSHA1）。</li><li>数据加密协议支持AES（AES128），DES。建议使用业界安全算法AES（AES128）。</li></ul>
</div>
</div></div>
<ul><li>版本：物理防火墙上的SNMP版本，支持V1、V2和V3版本。V1、V2版本存在安全风险，推荐使用V3版本。</li><li>端口：SNMP的端口号，默认为<span class="parmvalue">“161”</span>。</li><li>超时时间（s）：管理系统在重试SNMP请求前等待响应的时间长度，取值范围为1～60。</li><li>（V1和V2版本）读团体名：具有读访问模式的团体名。SNMP v1、SNMP v2c采用团体名认证，与设备认可的团体名不符的SNMP报文将被丢弃，团体名用一个字符串来命名。</li><li>（V1和V2版本）写团体名：具有写访问模式的团体名。SNMP v1、SNMP v2c采用团体名认证，与设备认可的团体名不符的SNMP报文将被丢弃，团体名用一个字符串来命名。</li><li><span>（V3版本）</span>安全用户名：网管用户访问被管理设备时使用的用户名。</li><li><span>（V3版本）</span>认证协议：验证传输数据是否合法时使用的协议。</li><li><span>（V3版本）</span>认证密码：验证传输数据是否合法时使用的密码。</li><li>（V3版本）确认认证密码：重新输入授权认证密码。</li><li><span>（V3版本）</span>数据加密协议：对传输数据进行加密时使用的协议。</li><li><span>（V3版本）</span>数据加密密码：对传输数据进行加密时使用的密码。</li><li>（V3版本）确认数据加密密码：重新输入数据加密密码。</li></ul>
</p>
</li><li><span>单击<span class="uicontrol">“下一步”</span>。</span></li><li><span>单击<span class="uicontrol">“完成”</span>。</span>
<p>完成物理防火墙的接入。</p>
</li></ol>

</div>

<div class="section"><h4 class="sectiontitle">后续任务</h4>


<div class="p"><p><strong>配置静态路由</strong></p>
<ol><li><p>使用<span class="parmname">“PuTTY”</span>，登录<span>FusionManager</span>。</p>
<p>以<span class="parmname">“galaxmanager”</span>用户，通过管理IP地址登录。</p>
</li><li>执行以下命令，防止<span class="parmname">“PuTTY”</span>超时退出。<p><b><span class="cmdname">TMOUT=0</span></b></p>
</li><li>执行以下命令，查看vfw配置文件内容。<p><b><span class="cmdname">modConfig vfw list</span></b></p>
<div class="p">显示如下参数信息：<pre class="screen">-------------------------------------------------------
#zoneName:vfwDomainName:vrfName:publicType
-------------------------------------------------------</pre>
</div>
</li><li><p>执行以下命令，添加静态路由信息，各参数相关说明<a href="#it_60_51_600012__tab_01">表1</a>所示。</p>
<p><b><span class="cmdname">modConfig vfw add</span></b></p>
<div class="p">
<div class="tablenoborder"><a name="it_60_51_600012__tab_01"></a><a name="tab_01"></a><table cellpadding="4" cellspacing="0" summary="" id="it_60_51_600012__tab_01" frame="border" border="1" rules="all"><caption><b>表1 </b>配置参数</caption>
<thead align="left">
<tr>
<th class="cellrowborder" valign="top" width="13.666666666666666%" id="mcps1.2.5.2.2.4.3.1.2.4.1.1"><p>参数</p>
</th>

<th class="cellrowborder" valign="top" width="17.333333333333336%" id="mcps1.2.5.2.2.4.3.1.2.4.1.2"><p>参数说明</p>
</th>

<th class="cellrowborder" valign="top" width="69%" id="mcps1.2.5.2.2.4.3.1.2.4.1.3"><p>配置原则</p>
</th>

</tr>

</thead>

<tbody>
<tr>
<td class="cellrowborder" valign="top" width="13.666666666666666%" headers="mcps1.2.5.2.2.4.3.1.2.4.1.1 "><p>zoneName</p>
</td>

<td class="cellrowborder" valign="top" width="17.333333333333336%" headers="mcps1.2.5.2.2.4.3.1.2.4.1.2 "><p>资源分区名称。</p>
</td>

<td class="cellrowborder" valign="top" width="69%" headers="mcps1.2.5.2.2.4.3.1.2.4.1.3 "><p>配置为系统中已存在的资源分区。</p>
</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="13.666666666666666%" headers="mcps1.2.5.2.2.4.3.1.2.4.1.1 "><p>vfwDomainName</p>
</td>

<td class="cellrowborder" valign="top" width="17.333333333333336%" headers="mcps1.2.5.2.2.4.3.1.2.4.1.2 "><p>虚拟防火墙中的域名称。</p>
</td>

<td class="cellrowborder" valign="top" width="69%" headers="mcps1.2.5.2.2.4.3.1.2.4.1.3 "><p>配置为虚拟机防火墙中已经存在的域名称。</p>
</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="13.666666666666666%" headers="mcps1.2.5.2.2.4.3.1.2.4.1.1 "><p>vrfName</p>
</td>

<td class="cellrowborder" valign="top" width="17.333333333333336%" headers="mcps1.2.5.2.2.4.3.1.2.4.1.2 "><p>vrf名称。</p>
</td>

<td class="cellrowborder" valign="top" width="69%" headers="mcps1.2.5.2.2.4.3.1.2.4.1.3 "><p>汇聚交换机中已存在的vrf名称，按照需要和规划配置。</p>
</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="13.666666666666666%" headers="mcps1.2.5.2.2.4.3.1.2.4.1.1 "><p>publicType</p>
</td>

<td class="cellrowborder" valign="top" width="17.333333333333336%" headers="mcps1.2.5.2.2.4.3.1.2.4.1.2 "><p>配置对应关系。可以配置为公网的路由关系或者网络的路由关系。</p>
</td>

<td class="cellrowborder" valign="top" width="69%" headers="mcps1.2.5.2.2.4.3.1.2.4.1.3 "><div class="p"><ul><li>配置为1：表示配置的关系为公网（弹性IP、SNAT、DNAT、VPN）的路由关系，即配置的路由为公网IP到虚拟防火墙的路由。一个资源分区下最多只能配置一个<span class="parmvalue">“publicType=1”</span>的路由关系。</li><li>配置为0：表示配置的为路由网络的路由关系，即配置的路由为路由网络网关到虚拟防火墙的路由。</li></ul>
</div>
</td>

</tr>

</tbody>

</table>
</div>
</div>
<div class="p">显示如下信息：<pre class="screen">Please input params [zoneName:vfwDomainName:vrfName:publicType]:</pre>
</div>
</li><li><p>输入具体的参数值。</p>
<p>例如，配置公网IP到虚拟防火墙的路由，输入<b><span class="cmdname">Zone01:untrust:InternetVRF:1</span></b></p>
<div class="p">显示如下信息，表示添加成功：<pre class="screen">insert success</pre>
</div>
<p>如果需要删除已添加的路由信息，执行命令<b><span class="cmdname">modConfig
vfw del</span></b>，按照提示输入要删除的路由信息。</p>
</li></ol>
</div>

</div>

<div class="section"><h4 class="sectiontitle">任务示例</h4>


<div class="p"><p><strong>汇聚交换机的路由信息样例</strong></p>
<div class="p">若以<span class="parmname">“static-route”</span>方式接入物理防火墙，并完成上述静态路由配置之后，发放了如下业务。<ul><li>在路由网络<span class="parmvalue">“192.168.30.0/24”</span>中创建了虚拟机1和虚拟机2。</li><li>该路由网络使用的虚拟防火墙untrust域端口IP地址为<span class="parmvalue">“192.168.60.5/24”</span>，name area01域端口IP地址为<span class="parmvalue">“192.168.61.5/24”</span>。</li><li>为虚拟机1绑定了一个公网IP地址<span class="parmvalue">“192.168.50.8”</span>。</li></ul>
则<span>FusionManager</span>会在汇聚交换机中，自动配置如下路由信息：<pre class="screen">
目的网络地址      掩码            下一跳地址
192.168.30.0    255.255.255.0     192.168.61.5
192.168.50.8    255.255.255.255   192.168.60.5</pre>
</div>
</div>

</div>

</div>


</body>
</html>
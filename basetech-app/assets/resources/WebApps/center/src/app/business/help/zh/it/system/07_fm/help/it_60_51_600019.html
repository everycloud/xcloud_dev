
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="zh-cn" xml:lang="zh-cn">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
<meta name="copyright" content="(C) 版权 2005">
<meta name="DC.rights.owner" content="(C) 版权 2005">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="如何修复虚拟机">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="it_60_51_600019">
<meta name="DC.Language" content="zh-cn">
<link rel="stylesheet" type="text/css" href="../../public_sys-resources/commonltr.css">
<title>如何修复虚拟机</title>
<script type="text/javascript" language="JavaScript">
//<![CDATA[
function reDo() {
  if (innerWidth != origWidth || innerHeight != origHeight)
     location.reload();
}
if ((parseInt(navigator.appVersion) == 4) && (navigator.appName == "Netscape")) {
	origWidth = innerWidth;
	origHeight = innerHeight;
	onresize = reDo;
}
onerror = null; 
//]]>
</script>
<style type="text/css">
<!--
div.WebHelpPopupMenu { position:absolute;
left:0px;
top:0px;
z-index:4;
visibility:hidden; }
-->
</style>
<script type="text/javascript" language="javascript1.2" src="../../whmsg.js"></script>
<script type="text/javascript" language="javascript" src="../../whver.js"></script>
<script type="text/javascript" language="javascript1.2" src="../../whproxy.js"></script>
<script type="text/javascript" language="javascript1.2" src="../../whutils.js"></script>
<script type="text/javascript" language="javascript1.2" src="../../whlang.js"></script>
<script type="text/javascript" language="javascript1.2" src="../../whtopic.js"></script>

 <meta name="generator" content="Adobe RoboHelp 9">
</head>
<body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px"><script type="text/javascript" language="javascript1.2">//<![CDATA[
<!--
if (window.gbWhTopic)
{
	var strUrl = decodeURI(document.location.href);
	var bc = 0;
	var n = strUrl.toLowerCase().indexOf("bc-");
	if(n != -1)
	{
		document.location.href = encodeURI(strUrl.substring(0, n));
		bc = strUrl.substring(n+3);
	}

	if (window.addTocInfo)
	{
	addTocInfo("FAQ\n虚拟机管理\n如何修复虚拟机");
addButton("show",BTN_TEXT,"显示","","","","",0,0,"","","");

	}
	if (window.writeBtnStyle)
		writeBtnStyle();

	if (window.writeIntopicBar)
		writeIntopicBar(1);

	
	document.write("<p style=\"text-align:right\"> ");
AddMasterBreadcrumbs("../../Help_Admin_System.htm", "", ">", "Home", "../father_node/it_60_99_start.html");
document.write("<a href=\"../father_node/it_60_99_faq.html\">FAQ<\/a> > <a href=\"../father_node/it_60_99_100032.html\">虚拟机管理<\/a> > 如何修复虚拟机<\/p>");


	if (window.setRelStartPage)
	{
	setRelStartPage("../../Help_Admin_System.htm");

		autoSync(1);
		sendSyncInfo();
		sendAveInfoOut();
	}
}
else
	if (window.gbIE4)
		document.location.reload();

//-->
//]]></script><a name="it_60_51_600019"></a><a name="it_60_51_600019"></a>


<h1 class="topictitle1">如何修复虚拟机</h1>
<ul><li><a href="#it_60_51_600019__1.2.1.1">操作场景</a></li><li><a href="#it_60_51_600019__1.2.2.1">注意事项</a></li><li><a href="#it_60_51_600019__1.2.3.1">前提条件</a></li><li><a href="#it_60_51_600019__1.2.4.1">操作步骤</a></li></ul>
<div>
<div class="section"><a name="it_60_51_600019__1.2.1.1"></a><a name="1.2.1.1"></a><h4 class="sectiontitle"><a href="#it_60_51_600019" class="sectiontitle2contents">操作场景</a></h4>


<div class="p"><p>当运行中的虚拟机出现故障，且无法通过VNC方式登录虚拟机时，可通过虚拟机模板修复该虚拟机的操作系统。在修复过程中，系统会按照模板重新创建虚拟机，并将新虚拟机的系统磁盘挂载到故障虚拟机上，故障虚拟机原有的系统磁盘将作为用户磁盘挂载在故障虚拟机上，原来存放在系统磁盘中的数据不会丢失。</p>
</div>

</div>

<div class="section"><a name="it_60_51_600019__1.2.2.1"></a><a name="1.2.2.1"></a><h4 class="sectiontitle"><a href="#it_60_51_600019" class="sectiontitle2contents">注意事项</a></h4>


<div class="p"><div class="p"><ul><li><p>VMware虚拟化环境中的虚拟机，不支持该操作。</p>
</li><li><p>按照虚拟机模板修复虚拟机后，虚拟机模板中已有的软件可以正常使用，但用户自行安装的软件可能无法正常使用。</p>
</li><li>按照虚拟机模板修复虚拟机后，虚拟机快照可能无法正常使用。</li></ul>
</div>
</div>

</div>

<div class="section"><a name="it_60_51_600019__1.2.3.1"></a><a name="1.2.3.1"></a><h4 class="sectiontitle"><a href="#it_60_51_600019" class="sectiontitle2contents">前提条件</a></h4>


<div class="p"><div class="p"><ul><li>已登录<span>FusionManager</span>。</li><li>已创建并发布虚拟机模板。</li><li>已查看并记录虚拟机磁盘的个数。</li><li>待修复的虚拟机是通过<span>FusionManager</span><span>或<span>FusionCompute</span></span>创建的。</li></ul>
</div>
</div>

</div>

<div class="section"><a name="it_60_51_600019__1.2.4.1"></a><a name="1.2.4.1"></a><h4 class="sectiontitle"><a href="#it_60_51_600019" class="sectiontitle2contents">操作步骤</a></h4>

<ul><div class="HandlingTitled"><p class="sectiontitle">修复虚拟机</p>
<div class="Steps-titled"><ol type="1" start="1"><li><span>单击待修复的虚拟机名称。</span>
<p>进入<span class="wintitle">“概要”</span>页面。</p>
</li><li id="it_60_51_600019__step1"><a name="it_60_51_600019__step1"></a><a name="step1"></a><span>选择<span class="menucascade">“<span class="uicontrol">更多</span> &gt; <span class="uicontrol">修复虚拟机</span>”</span>。</span>
<p><ul><li><p>弹出<span class="wintitle">“确认”</span>对话框，单击<span class="parmname">“确定”</span>。</p>
</li><li><p>弹出<span class="wintitle">“选择模板”</span>对话框，选择用于修复虚拟机模板，并单击<span class="parmname">“修复”</span>。</p>
</li></ul>
</p>
</li><li><span>在虚拟机列表上，单击修复后的虚拟机。</span></li><li id="it_60_51_600019__step8"><a name="it_60_51_600019__step8"></a><a name="step8"></a><span>待虚拟机状态变为<span class="parmname">“运行”</span>后，在<span class="uicontrol">“硬件”</span>页面中，查看虚拟机磁盘个数。</span>
<p><ul><li>如果虚拟机磁盘个数增加，表示虚拟机修复成功。执行<a href="#it_60_51_600019__xiufu">5</a>。</li><li>如果虚拟机磁盘个数不变，请重复执行<a href="#it_60_51_600019__step1">2</a>～<a href="#it_60_51_600019__step8">4</a>。</li></ul>
</p>
</li><li id="it_60_51_600019__xiufu"><a name="it_60_51_600019__xiufu"></a><a name="xiufu"></a><span>管理员通知虚拟机用户，其虚拟机已修复，需进行磁盘恢复。</span></li><li><span>用户登录其虚拟机，根据虚拟机操作系统类型选择相应操作：</span>
<p><ul><li>Windows，执行<a href="#it_60_51_600019__windows">7</a>。</li><li>Linux，执行<a href="#it_60_51_600019__linux">11</a>。</li></ul>
</p>
</li></ol></div>
</div>
<div class="HandlingTitled"><p class="sectiontitle">Windows操作系统下恢复磁盘</p>
<p>以下操作以Windows 7操作系统为例。</p><div class="Steps-titled"><ol type="1" start="7"><li id="it_60_51_600019__windows"><a name="it_60_51_600019__windows"></a><a name="windows"></a><span>在虚拟机操作系统任务栏，单击<span class="uicontrol">“开始”</span>，右键单击<span class="uicontrol">“计算机”</span>，选择<span class="menucascade">“<span class="uicontrol">管理</span>”</span>。</span></li><li><span>在左侧导航树上，选择<span class="menucascade">“<span class="uicontrol">磁盘管理</span>”</span>。</span></li><li><span>在中间窗格下方区域中，右键单击状态为<span class="parmname">“脱机”</span>的磁盘区域，选择<span class="menucascade">“<span class="uicontrol">联机</span>”</span>。</span></li><li><span>关闭<span class="wintitle">“计算机管理”</span>窗口。</span>
<p>可在<span class="wintitle">“计算机”</span>中，看到恢复的数据磁盘。任务结束。</p>
</li></ol></div>
</div>
<div class="HandlingTitled"><p class="sectiontitle">Linux操作系统下恢复磁盘</p>
<div class="Steps-titled"><ol type="1" start="11"><li id="it_60_51_600019__linux"><a name="it_60_51_600019__linux"></a><a name="linux"></a><span>在虚拟机界面，右键单击桌面空白区域，选择<span class="menucascade">“<span class="uicontrol">在终端中打开</span>”</span>。</span></li><li><span>执行以下命令，查看并获取数据磁盘信息。</span>
<p><p><b><span class="cmdname">fdisk -l</span></b></p>
</p>
</li><li><span>执行以下命令，创建一个新目录。</span>
<p><p><b><span class="cmdname">mkdir </span></b><i><span class="varname">目录名称</span></i></p>
<p>例如，<b><span class="cmdname">mkdir </span></b><i><span class="varname">repair</span></i></p>
</p>
</li><li><span>执行以下命令，将磁盘挂载到创建的目录下。</span>
<p><p><b><span class="cmdname">mount </span></b><i><span class="varname">数据磁盘 </span></i><i><span class="varname">新建的目录名称</span></i></p>
<p>例如，<b><span class="cmdname">mount </span></b><i><span class="varname">/dev/xvdf2 </span></i><i><span class="varname">repair</span></i></p>
<div class="note"><img src="../../public_sys-resources/icon-note.gif"><span class="notetitle"> 说明： </span><div class="notebody"><ul><li>若挂载的磁盘未分区、已经挂载或未格式化，会导致挂载操作失败。</li><li>用户可能需要进行多次挂载操作，直到找到需要的磁盘。</li></ul>
</div></div>
</p>
</li><li><span>执行以下命令，访问数据磁盘信息。</span>
<p><p><b><span class="cmdname">cd </span></b><i><span class="varname">目录名称</span></i></p>
<p>例如，<b><span class="cmdname">cd </span></b><i><span class="varname">repair</span></i></p>
<div class="note"><img src="../../public_sys-resources/icon-note.gif"><span class="notetitle"> 说明： </span><div class="notebody">恢复的磁盘在虚拟机中盘符可能发生改变。</div></div>
</p>
</li></ol></div>
</div>
<a name="it_60_51_600019__net"></a><a name="net"></a><div class="HandlingTitled" id="it_60_51_600019__net"><p class="sectiontitle">Linux操作系统下恢复网络配置</p>
<p>若虚拟机网卡获取IP地址的方式为静态注入方式，则在该虚拟机修复后，其网卡序号会变更，导致与网卡配置文件名称无法对应，造成丢失IP地址的问题。需要按照以下方法，修复虚拟机的网卡配置文件。</p><div class="Steps-titled"><ol type="1" start="16"><li><span>在虚拟机界面，右键单击桌面空白区域，选择<span class="uicontrol">“在终端中打开”</span>。</span>
</li><li><span>执行以下命令，查看网卡MAC地址信息。</span>
<p><p><b><span class="cmdname">ifconfig -a</span></b></p>
<p>网卡序号后的<span class="parmname">“HWaddr”</span>参数表示该网卡的MAC地址。记录每个网卡序号和其<span class="parmname">“HWaddr”</span>参数值。例如，<span class="parmvalue">“eth3”</span>网卡序号后的<span class="parmname">“HWaddr”</span>参数值为<span class="parmvalue">“28:6E:D4:88:C7:B0”</span>。</p>
</p>
</li><li><span>执行以下命令，查看网卡配置文件名称。</span>
<p><p><b><span class="cmdname">cd /etc/sysconfig/network</span></b></p>
<p><b><span class="cmdname">ls</span></b></p>
<p>文件名称为<span class="parmvalue">“ifcfg-eth*”</span>的均为网卡配置文件。例如<span class="parmvalue">“ifcfg-eth2”</span>。</p>
</p>
</li><li><span>执行以下命令，查看网卡配置文件中的IP地址信息。</span>
<p><p><b><span class="cmdname">cat </span></b><i><span class="varname">网卡文件名称</span></i></p>
<p>例如，执行以下命令，查看<span class="parmvalue">“ifcfg-eth2”</span>文件。</p>
<p><b><span class="cmdname">cat ifcfg-eth2</span></b></p>
</p>
</li><li><span>根据如下数值，判断修复后的网卡序号是否变更。</span>
<p><ul><li>网卡文件名称和文件中的IP地址</li><li>网卡序号和<span class="parmname">“HWaddr”</span>所显示的MAC地址所对应的虚拟机修复前的IP地址：该对应关系，可由管理员在<span>FusionManager</span>界面，该虚拟机<span class="wintitle">“概要”</span>页面，选择<span class="menucascade">“<span class="uicontrol">更多</span> &gt; <span class="uicontrol">初始网络配置</span>”</span>进行查看。</li></ul>
<div class="p">例如：<ul><li>网卡文件名称和文件中的IP地址：网卡文件<span class="parmvalue">“ifcfg-eth2”</span>中记录的IP地址为<span class="parmvalue">“192.168.10.136”</span>。</li><li>网卡序号和<span class="parmname">“HWaddr”</span>所显示的MAC地址所对应的虚拟机修复前的IP地址：网卡序号<span class="parmvalue">“eth3”</span>的<span class="parmname">“HWaddr”</span>参数值为<span class="parmvalue">“28:6E:D4:88:C7:B0”</span>，在<span class="uicontrol">“初始网络配置”</span>查看到对应的IP地址同样为<span class="parmvalue">“192.168.10.136”</span>。</li></ul>
</div>
<p>若出现举例中的情况，则表示虚拟机网卡<span class="parmvalue">“eth2”</span>在修复后变为了<span class="parmvalue">“eth3”</span>。</p>
</p>
</li><li><span>执行以下命令，在<span class="filepath">“/etc/sysconfig/network”</span>目录中，拷贝网卡文件并根据新的网卡序号命名。</span>
<p><p><b><span class="cmdname">cp</span></b><i><span class="varname"> 原网卡文件名称</span></i><i><span class="varname"> 新网卡文件名称</span></i></p>
<p>例如，执行以下命令，将<span class="parmvalue">“ifcfg-eth2”</span>文件拷贝为<span class="parmvalue">“ifcfg-eth3”</span>。</p>
<p><b><span class="cmdname">cp ifcfg-eth2
ifcfg-eth3</span></b></p>
</p>
</li><li><span>执行以下命令，重启虚拟机网络服务。</span>
<p><p><b><span class="cmdname">service network restart</span></b></p>
</p>
</li></ol></div>
</div>
<a name="it_60_51_600019__install"></a><a name="install"></a><div class="HandlingTitled" id="it_60_51_600019__install"><p class="sectiontitle">后续任务</p>
<p>虚拟机修复后，原故障虚拟机的系统磁盘，将被当作用户磁盘挂载到修复后的虚拟机上，因此在原虚拟机中所安装的软件，可能因为系统注册表的原因将无法使用，用户需自行重新安装。</p></div>
</ul>

</div>

</div>


<div class="hrcopyright"><hr size="2"></div><div class="hwcopyright">华为专有和保密信息</div><div class="hwcopyright">版权所有 &copy; 华为技术有限公司</div><script type="text/javascript" language="javascript1.2">//<![CDATA[
<!--
if (window.writeIntopicBar)
	writeIntopicBar(0);


highlightSearch();
//-->
//]]></script>
</body>
</html>
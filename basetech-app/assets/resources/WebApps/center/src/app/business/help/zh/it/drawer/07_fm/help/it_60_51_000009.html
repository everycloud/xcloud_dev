
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="zh-cn" xml:lang="zh-cn">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=gb2312">
   
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
<meta name="copyright" content="(C) 版权 2005">
<meta name="DC.rights.owner" content="(C) 版权 2005">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="VXLAN">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="it_60_51_000009">
<meta name="DC.Language" content="zh-cn">
<link rel="stylesheet" type="text/css" href="../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../public_sys-resources/ExpandCollapse.js"></script>
<title>VXLAN</title>
</head>
<body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px"><a name="it_60_51_000009"></a><a name="it_60_51_000009"></a>



<h1 class="topictitle1">VXLAN</h1>

<div>
<div class="section" id="it_60_51_000009__sec_overView"><a name="it_60_51_000009__sec_overView"></a><a name="sec_overView"></a><h4 class="sectiontitle">简介</h4><p id="it_60_51_000009__vxlan1"><a name="it_60_51_000009__vxlan1"></a><a name="vxlan1"></a>VXLAN（Virtual
eXtensible Local Area Network）是建立在物理网络之上的虚拟以太网，将二层报文用三层协议进行封装，对二层网络在三层范围进行扩展，突破了目前广泛采用的VLAN所能表示的2<sup>12</sup>个隔离网络的限制，可以使用户创建约2<sup>24</sup>个相互隔离的虚拟网络。VXLAN可用于多租户环境下的大规模网络部署。</p>
</div>

<div class="section" id="it_60_51_000009__sec_principle"><a name="it_60_51_000009__sec_principle"></a><a name="sec_principle"></a><h4 class="sectiontitle">原理概述</h4><p>使用VXLAN技术通信的两端称为VTEP（VXLAN
Tunneling End Point），位于<span>FusionManager</span>所管理的主机中，负责VXLAN报文的封装和解封装工作，以及在转发报文中对虚拟机MAC地址和IP地址的映射关系进行学习。</p>
<p>如<a href="#it_60_51_000009__fig_vxlan">图1</a>所示，不同主机上的两个虚拟机VM1和VM2，都处于VXLAN
ID为6000的网络中。VM1与VM2通信时，主机1上的VTEP1会查找VM1所属的VXLAN ID，并将来自于VM1的物理帧封装成VXLAN报文，通过与另一台主机上的VTEP2组成VXLAN隧道，进行VXLAN报文的传输。VTEP2在接收到VXLAN报文后对其进行解封装，并将物理帧发送给VM2。</p>
<div class="fignone" id="it_60_51_000009__fig_vxlan"><a name="it_60_51_000009__fig_vxlan"></a><a name="fig_vxlan"></a><span class="figcap"><b>图1 </b>VXLAN原理</span>

<br><span><img src="fig/fig_it_60_51_000009_02.png"></span></div>
<p>VXLAN网络的网关位于软件路由器上，实现了VXLAN网络之间，以及VXLAN网络与VLAN网络之间的通信，如<a href="#it_60_51_000009__fig_gw">图2</a>所示。</p>
<div class="fignone" id="it_60_51_000009__fig_gw"><a name="it_60_51_000009__fig_gw"></a><a name="fig_gw"></a><span class="figcap"><b>图2 </b>VXLAN的网关</span>

<br><span><img src="fig/fig_it_60_51_000009_03.png"></span></div>
</div>

<div class="section" id="it_60_51_000009__sec_caution"><a name="it_60_51_000009__sec_caution"></a><a name="sec_caution"></a><h4 class="sectiontitle">注意事项</h4><p>使用VXLAN功能之前，您需要了解以下注意事项：</p>
<ul><li>&#61550;VTEP IP不能与同主机的系统接口IP同网段。</li><li>&#61550;VTEP IP和同一主机的其他VTEP IP不能在同一网段。</li><li>&#61550;不同VTEP不能使用相同的IP地址。</li></ul>
</div>

<div class="section"><h4 class="sectiontitle">需要准备的软件</h4><div class="p">创建VXLAN网络时，需要获取如<a href="#it_60_51_000009__tbl_01">表1</a>所示的软件。
<div class="tablenoborder"><a name="it_60_51_000009__tbl_01"></a><a name="tbl_01"></a><table cellpadding="4" cellspacing="0" summary="" id="it_60_51_000009__tbl_01" frame="border" border="1" rules="all"><caption><b>表1 </b>软件</caption>
<thead align="left">
<tr>
<th class="cellrowborder" valign="top" width="23%" id="mcps1.2.4.2.2.2.4.1.1"><p>名称</p>
</th>

<th class="cellrowborder" valign="top" width="35.75%" id="mcps1.2.4.2.2.2.4.1.2"><p>说明</p>
</th>

<th class="cellrowborder" valign="top" width="41.25%" id="mcps1.2.4.2.2.2.4.1.3"><p>获取方式</p>
</th>

</tr>

</thead>

<tbody>
<tr>

<td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.4.2.2.2.4.1.1 "><span class="filepath">“FusionCompute V100R005C00SPC200_VSA.zip”</span></td>

<td class="cellrowborder" valign="top" width="35.75%" headers="mcps1.2.4.2.2.2.4.1.2 "><p>系统服务虚拟机模板文件，申请软件路由器时，系统会自动通过此模板文件创建系统服务虚拟机，提供路由器功能。</p>
</td>

<td class="cellrowborder" valign="top" width="41.25%" headers="mcps1.2.4.2.2.2.4.1.3 "><div class="p" id="it_60_51_000009__p_soft1"><a name="it_60_51_000009__p_soft1"></a><a name="p_soft1"></a><ul><li><p>企业用户：<span class="menucascade">“<span class="uicontrol">http://support.huawei.com/enterprise </span> &gt; <span class="uicontrol">软件下载</span> &gt; <span class="uicontrol">IT</span> &gt; <span class="uicontrol">云计算</span> &gt; <span class="uicontrol">云操作系统</span> &gt; <span class="uicontrol">FusionCompute</span> &gt; <span class="uicontrol">V100R005C00SPC100</span>”</span></p>
</li><li><p>运营商用户：<span class="menucascade">“<span class="uicontrol">http://support.huawei.com</span> &gt; <span class="uicontrol">产品软件</span> &gt; <span class="uicontrol">电信软件与核心网</span> &gt; <span class="uicontrol">电信云计算</span> &gt; <span class="uicontrol">IT云基础设施解决方案</span> &gt; <span class="uicontrol">Cloud
OS</span> &gt; <span class="uicontrol">FusionCompute</span> &gt; <span class="uicontrol">V100R005C00SPC100</span>”</span></p>
</li></ul>
</div>
</td>

</tr>

</tbody>

</table>
</div>
<div class="note"><img src="../theme/default/images/icon-note.gif"><span class="notetitle"> 说明： </span><div class="notebody">获取到软件包后建议先执行软件包校验的操作，具体操作请参见<a href="../soft_inst/it_60_23_000021.html">校验软件包</a>。</div></div>
</div>
</div>

<div class="section"><h4 class="sectiontitle">配置流程</h4><p id="it_60_51_000009__vxlan2"><a name="it_60_51_000009__vxlan2"></a><a name="vxlan2"></a><span>FusionManager</span>支持在VPC中创建VXLAN类型的内部网络和路由网络。</p>
<p>创建VXLAN类型的网络之前，需要系统管理员按照如<a href="#it_60_51_000009__fig_vxlanProcess">图3</a>所示流程完成资源配置。</p>
<div class="fignone" id="it_60_51_000009__fig_vxlanProcess"><a name="it_60_51_000009__fig_vxlanProcess"></a><a name="fig_vxlanProcess"></a><span class="figcap"><b>图3 </b>VXLAN配置流程</span>

<br><span><img src="fig/fig_it_60_51_000009_01.png"></span></div>
<p>配置流程中的各任务说明如<a href="#it_60_51_000009__table_vxlan">表2</a>所示。</p>

<div class="tablenoborder"><a name="it_60_51_000009__table_vxlan"></a><a name="table_vxlan"></a><table cellpadding="4" cellspacing="0" summary="" id="it_60_51_000009__table_vxlan" frame="border" border="1" rules="all"><caption><b>表2 </b>任务说明</caption>
<thead align="left">
<tr>
<th class="cellrowborder" valign="top" width="27.333333333333332%" id="mcps1.2.5.6.2.4.1.1"><p>任务</p>
</th>

<th class="cellrowborder" valign="top" width="39.666666666666664%" id="mcps1.2.5.6.2.4.1.2"><p>说明</p>
</th>

<th class="cellrowborder" valign="top" width="33%" id="mcps1.2.5.6.2.4.1.3"><p>界面入口</p>
</th>

</tr>

</thead>

<tbody>
<tr>

<td class="cellrowborder" valign="top" width="27.333333333333332%" headers="mcps1.2.5.6.2.4.1.1 "><p>配置交换机组播功能</p>
</td>

<td class="cellrowborder" valign="top" width="39.666666666666664%" headers="mcps1.2.5.6.2.4.1.2 "><p id="it_60_51_000009__p_igmp"><a name="it_60_51_000009__p_igmp"></a><a name="p_igmp"></a>在汇聚交换机和接入交换机对规划的VTEP的VLAN配置三层组播转发、IGMP-SNOOPING功能。</p>
<div class="note"><span class="notetitle"> 说明： </span><div class="notebody"><p>在运行组播业务时，组播通道上需开启交换机的IGMP侦听功能和设备的查询器功能。一般可通过在交换机shell中执行相关命令开启，详细配置步骤请参见交换机的配置说明。</p>
</div></div>
</td>

<td class="cellrowborder" valign="top" width="33%" headers="mcps1.2.5.6.2.4.1.3 "><p>本任务需要在交换机上手工进行配置，具体请参考<a href="it_60_51_600002.html">如何配置交换机组播功能</a>。</p>
</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="27.333333333333332%" headers="mcps1.2.5.6.2.4.1.1 "><p>在FusionCompute上配置VTEP</p>
</td>

<td class="cellrowborder" valign="top" width="39.666666666666664%" headers="mcps1.2.5.6.2.4.1.2 "><p id="it_60_51_000009__p_fcvtep"><a name="it_60_51_000009__p_fcvtep"></a><a name="p_fcvtep"></a>在FusionCompute上为<span>DVS</span>的上行链路配置VTEP信息。</p>
</td>

<td class="cellrowborder" valign="top" width="33%" headers="mcps1.2.5.6.2.4.1.3 "><p>在FusionCompute上，选择<span class="menucascade">“<span class="uicontrol">计算池</span> &gt; <span class="uicontrol"><i><span class="varname">站点</span></i></span> &gt; <span class="uicontrol"><i><span class="varname">集群</span></i></span>”</span>，在<span class="wintitle">“操作”</span>中选择<span class="wintitle">“批量添加VXLAN
VTEP”</span>。</p>
</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="27.333333333333332%" headers="mcps1.2.5.6.2.4.1.1 "><p>创建VLAN池</p>
</td>

<td class="cellrowborder" valign="top" width="39.666666666666664%" headers="mcps1.2.5.6.2.4.1.2 "><p id="it_60_51_000009__p_vxlanpool"><a name="it_60_51_000009__p_vxlanpool"></a><a name="p_vxlanpool"></a>在<span>FusionManager</span>网络资源池的VLAN池中，添加规划的VXLAN网络的VLAN ID、外部网络的VLAN ID，并将VLAN池关联到<span>DVS</span>。</p>
</td>

<td class="cellrowborder" valign="top" width="33%" headers="mcps1.2.5.6.2.4.1.3 ">在<span class="menucascade">“<span class="uicontrol">资源</span> &gt; <span class="uicontrol">资源分区</span>”</span>界面，选择一个资源分区，选择<span class="menucascade">“<span class="uicontrol">网络资源池</span> &gt; <span class="uicontrol">VLAN池</span>”</span>。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="27.333333333333332%" headers="mcps1.2.5.6.2.4.1.1 "><p>添加组播IP池</p>
</td>

<td class="cellrowborder" valign="top" width="39.666666666666664%" headers="mcps1.2.5.6.2.4.1.2 "><p id="it_60_51_000009__p_mutip"><a name="it_60_51_000009__p_mutip"></a><a name="p_mutip"></a>组播池中的IP地址用于标识VXLAN网络，当虚拟机加入到VXLAN网络时，其所在主机会加入到与组播IP对应的组播组中，接收目的地址为这个组播IP的报文。</p>
</td>

<td class="cellrowborder" valign="top" width="33%" headers="mcps1.2.5.6.2.4.1.3 ">在<span class="menucascade">“<span class="uicontrol">资源</span> &gt; <span class="uicontrol">资源分区</span>”</span>界面，选择一个资源分区，选择<span class="menucascade">“<span class="uicontrol">网络资源池</span> &gt; <span class="uicontrol">VLAN池</span>”</span>。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="27.333333333333332%" headers="mcps1.2.5.6.2.4.1.1 "><p>创建外部网络</p>
</td>

<td class="cellrowborder" valign="top" width="39.666666666666664%" headers="mcps1.2.5.6.2.4.1.2 "><p>本任务中的外部网络用于连接软件路由器，为路由网络中关联的虚拟机访问公网提供公网IP地址资源。在<span>FusionManager</span>上创建外部网络时要求能够连接到Internet，且子网的分配方式为静态注入，子网类型为普通。</p>
</td>

<td class="cellrowborder" valign="top" width="33%" headers="mcps1.2.5.6.2.4.1.3 ">在<span class="menucascade">“<span class="uicontrol">资源</span> &gt; <span class="uicontrol">资源分区</span>”</span>界面，选择一个资源分区，选择<span class="menucascade">“<span class="uicontrol">网络资源池</span> &gt; <span class="uicontrol">外部网络</span>”</span>。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="27.333333333333332%" headers="mcps1.2.5.6.2.4.1.1 "><p>创建VSA管理网络</p>
</td>

<td class="cellrowborder" valign="top" width="39.666666666666664%" headers="mcps1.2.5.6.2.4.1.2 "><div class="p">VSA管理网络用来为系统服务虚拟机提供管理平面网络，其配置要求如下：<ul><li>VSA管理网络与系统管理平面互通。</li><li>VSA管理网络的VLAN要添加到FusionCompute的分布式交换机中，但在<span>FusionManager</span>的VLAN池中不能包含此VLAN。</li></ul>
</div>
</td>

<td class="cellrowborder" valign="top" width="33%" headers="mcps1.2.5.6.2.4.1.3 ">在<span class="menucascade">“<span class="uicontrol">资源</span> &gt; <span class="uicontrol">资源分区</span>”</span>界面，选择一个资源分区，选择<span class="menucascade">“<span class="uicontrol">网络资源池</span> &gt; <span class="uicontrol">VSA网络</span>”</span>。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="27.333333333333332%" headers="mcps1.2.5.6.2.4.1.1 "><p>创建VTEP网络</p>
</td>

<td class="cellrowborder" valign="top" width="39.666666666666664%" headers="mcps1.2.5.6.2.4.1.2 "><p id="it_60_51_000009__p_fmvtep"><a name="it_60_51_000009__p_fmvtep"></a><a name="p_fmvtep"></a>配置VXLAN功能时，使用VTEP网络为软件路由器分配IP地址，用于路由器与主机上的VTEP进行通信。</p>
</td>

<td class="cellrowborder" valign="top" width="33%" headers="mcps1.2.5.6.2.4.1.3 ">在<span class="menucascade">“<span class="uicontrol">资源</span> &gt; <span class="uicontrol">资源分区</span>”</span>界面，选择一个资源分区，选择<span class="menucascade">“<span class="uicontrol">网络资源池</span> &gt; <span class="uicontrol">VSA网络</span>”</span>。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="27.333333333333332%" headers="mcps1.2.5.6.2.4.1.1 "><p>导入VSA虚拟机模板</p>
</td>

<td class="cellrowborder" valign="top" width="39.666666666666664%" headers="mcps1.2.5.6.2.4.1.2 "><p>VSA虚拟机模板为系统自动创建系统服务虚拟机提供模板资源。</p>
</td>

<td class="cellrowborder" valign="top" width="33%" headers="mcps1.2.5.6.2.4.1.3 "><span class="menucascade">“<span class="uicontrol">资源</span> &gt; <span class="uicontrol">模板和规格</span> &gt; <span class="uicontrol">虚拟机模板</span>”</span></td>

</tr>

</tbody>

</table>
</div>
</div>

</div>


</body>
</html>
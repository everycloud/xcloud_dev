<div class="user_detail" ng-controller="userMgr.user.detail.ctrl">
    <div class="container-fluid">
        <div class="row-fluid innerbox-padding">
            <div class="span6">
                <div class="inner-legend">{{i18n.common_term_basicInfo_label}}</div>
                <div class="row-fluid">
                    <div class="span6">
                        <tiny-formfield>
                            <tiny-item label="name.label">
                                <span ng-bind="name.value"></span>
                            </tiny-item>
                            <tiny-item label="email.label">
                                <span ng-bind="email.value"></span>
                            </tiny-item>
                            <tiny-item label="accessDate.label" display="!openstack">
                                <span ng-bind="accessDate.value"></span>
                            </tiny-item>
                        </tiny-formfield>
                    </div>
                    <div class="span6">
                        <tiny-formfield>
                            <tiny-item label="phone.label" display="!openstack">
                                <span ng-bind="phone.value"></span>
                            </tiny-item>
                            <tiny-item label="createTime.label" display="!openstack">
                                <span ng-bind="createTime.value"></span>
                            </tiny-item>
                            <tiny-item label="accessTime.label" display="!openstack">
                                <span ng-bind="accessTime.value"></span>
                            </tiny-item>
                        </tiny-formfield>
                    </div>
                </div>
                <div>
                    <tiny-formfield>
                        <tiny-item label="ipAddress.label" display="!openstack">
                            <span ng-bind="ipAddress.value"></span>
                        </tiny-item>
                        <tiny-item label="description.label">
                            <span ng-bind="description.value"></span>
                        </tiny-item>
                    </tiny-formfield>
                </div>
            </div>
            <div class="span6">
                <div class="inner-legend none-line">{{i18n.role_term_sysMgrRole_value}}</div>
                <div style="max-height: 200px;overflow: auto;">
                    <tiny-table id="roleModel.id" data="roleModel.datas" columns="roleModel.columns" enable-pagination="roleModel.pagination" render-row="roleModel.renderRow"></tiny-table>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
require(["jquery",
        "app/business/user/controllers/user/userDetailCtrl"
    ],
    function($, userDetailCtrl) {

        //替换ID，使ID唯一
        var lineNum = $(".user_detail").parent().parent().parent().prev().attr("lineNum");
        var userId = $(".user_detail").parent().parent().parent().prev().attr("userId");
        var domId = "userDetail" + lineNum;
        var className = "user_detail" + lineNum;

        // 1.获取当前Dom
        var curView = undefined;
        $(".user_detail").each(function() {
            if ($(this).attr("id") === undefined) {
                curView = $(this);
            }
        });

        curView.attr("id", domId);
        curView.attr("class", className);

        // 2.编译
        var scope = curView.scope();
        var modules = ["wcc", userDetailCtrl.name];
        modules.unshift(["$provide",
            function($provide) {
                $provide.value("$rootElement", curView);
            }
        ]);
        modules.unshift("ng");
        var $injector = angular.injector(modules);
        $injector.invoke(["$compile",
            function($compile) {
                $compile(curView)(scope);
                scope.$digest();
            }
        ]);

        // 3.初始化scope
        var newScope = curView.scope();
        newScope.$apply(function() {
            newScope.userId = userId;
            newScope.operator.getUserDetail();
        });
    });
</script>

